[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "DataSHIELD Workshop",
    "section": "",
    "text": "Introduction\nThis website hosts the materials and exercises for the DataSHIELD workshop at the Institut Català d’Oncologia (ICO).\nOn it you will find reading materials, setup tutorials, workshop indications and practical exercises.",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Workshop Introduction</span>"
    ]
  },
  {
    "objectID": "index.html#getting-started",
    "href": "index.html#getting-started",
    "title": "DataSHIELD Workshop",
    "section": "Getting Started",
    "text": "Getting Started\nAll practical exercises will be conducted using the public Opal demo server. This server provides a fully functional DataSHIELD environment with sample datasets that workshop participants can use to replicate the examples.\nLogin credentials for the demo server are:\n\nUsername: dsuser\nPassword: P@ssw0rd",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Workshop Introduction</span>"
    ]
  },
  {
    "objectID": "index.html#prerequisites",
    "href": "index.html#prerequisites",
    "title": "DataSHIELD Workshop",
    "section": "Prerequisites",
    "text": "Prerequisites\nBefore starting, make sure to install the required R packages in your local machine:\n\ninstall.packages('DSI')\ninstall.packages('DSOpal')\ninstall.packages('dsBaseClient', repos=c(getOption('repos'), 'http://cran.datashield.org'), dependencies=TRUE)\ninstall.packages('metafor')\ndevtools::install_github('lifecycle-project/ds-helper')\ndevtools::install_github('isglobal-brge/dsOMOPClient')\ndevtools::install_github('isglobal-brge/dsOMOPHelper')",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Workshop Introduction</span>"
    ]
  },
  {
    "objectID": "index.html#slides",
    "href": "index.html#slides",
    "title": "DataSHIELD Workshop",
    "section": "Slides",
    "text": "Slides\nYou can find the slides used in the workshop in the following links:\n\nDataSHIELD slides\ndsOMOP slides",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Workshop Introduction</span>"
    ]
  },
  {
    "objectID": "index.html#complementary-materials",
    "href": "index.html#complementary-materials",
    "title": "DataSHIELD Workshop",
    "section": "Complementary materials",
    "text": "Complementary materials\n\nDataSHIELD Beginner’s Tutorial\nResource bookdown: Examples of resources\nOHDSI Book chapter ‘The Common Data Model’\nOHDSI Book chapter ‘Standardized Vocabularies’\ndsOMOP website\nUsing tidyverse within DataSHIELD",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Workshop Introduction</span>"
    ]
  },
  {
    "objectID": "index.html#exercises-solutions",
    "href": "index.html#exercises-solutions",
    "title": "DataSHIELD Workshop",
    "section": "Exercises solutions",
    "text": "Exercises solutions\n\nDataSHIELD exercises solutions",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Workshop Introduction</span>"
    ]
  },
  {
    "objectID": "index.html#schedule",
    "href": "index.html#schedule",
    "title": "DataSHIELD Workshop",
    "section": "Schedule",
    "text": "Schedule\n\n\n\nTime\nTopic\n\n\n\n\n09:00\nWelcome\n\n\n09:15 - 09:45\nIntroduction to DataSHIELD and OPAL\n\n\n09:45 - 11:00\nWorkshop DataSHIELD data analysis + exercise\n\n\n11:00 - 11:30\nBreak\n\n\n11:30 - 12:00\nIntroduction to OMOP and dsOMOP and extensions\n\n\n12:00 - 12:30\nWorkshop dsOMOP dataset creation + analysis",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Workshop Introduction</span>"
    ]
  },
  {
    "objectID": "index.html#credits",
    "href": "index.html#credits",
    "title": "DataSHIELD Workshop",
    "section": "Credits",
    "text": "Credits\nMaterial developed at the Bioinformatics Research Group in Epidemiology (BRGE) of the Barcelona Institute for Global Health (ISGlobal) by Juan R González and David Sarrat González.",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Workshop Introduction</span>"
    ]
  },
  {
    "objectID": "chapters/datashield.html",
    "href": "chapters/datashield.html",
    "title": "DataSHIELD Workshop",
    "section": "",
    "text": "INFORMATION FOR NEWCOMERS TO RSTUDIO NOTEBOOKS:\nThis is an R Markdown Notebook. When you execute code within the notebook, the results appear beneath the code. Here you can download the .Rmd file to reproduce this bookdown using RStudio (in case the download does not work, right click on the link and select “Save link as…”). You can also copy and paste the R code available in every step.\nTry executing each chunk by clicking the Run button within the chunk or by placing your cursor inside it and pressing Ctrl+Shift+Enter.\nThe plan for this lesson is as follows:",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>DataSHIELD Workshop</span>"
    ]
  },
  {
    "objectID": "chapters/datashield.html#installing-datashield",
    "href": "chapters/datashield.html#installing-datashield",
    "title": "DataSHIELD Workshop",
    "section": "Installing DataSHIELD",
    "text": "Installing DataSHIELD\nFirstly: check whether we have the right R packages installed to run DataSHIELD: using the very helpful devtools package, we’ll use the “Session info” command:\n\ninstall.packages(\"devtools\")\nlibrary(devtools)\ndevtools::session_info()\n\nWe are missing some of the necessary packages: “DSI”, “DSOpal” and “dsBaseClient”.\n\ninstall.packages('DSI')\ninstall.packages('DSOpal')\ninstall.packages('dsBaseClient', repos=c(getOption('repos'), 'http://cran.datashield.org'), dependencies=TRUE)\ninstall.packages('metafor')\ndevtools::install_github('lifecycle-project/ds-helper')\n\nRemember to load them into this R session using “library()” command:\n\nlibrary(DSI)\nlibrary(DSOpal)\nlibrary(dsBaseClient)\nlibrary(dsHelper)\nlibrary(metafor)\n\nCheck that they have now been added:\n\ndevtools::session_info()",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>DataSHIELD Workshop</span>"
    ]
  },
  {
    "objectID": "chapters/datashield.html#logging-in-and-assigning-data",
    "href": "chapters/datashield.html#logging-in-and-assigning-data",
    "title": "DataSHIELD Workshop",
    "section": "Logging in and assigning data",
    "text": "Logging in and assigning data\nThe login script has to be customized to fit the data you are trying to connect to.\nThe “builder &lt;-” and “builder$append” functions are standard features.\nFor this demonstration we are connecting to simulated data- but if it was data of real people, it would be very important for us not to be able to see individual patients’ information.\nLet’s log in to the Opal online portal to see what data is available.\nWe will use the simulated dataset CNSIM, in a data.frame with 4128 observations of 11 harmonized variables. The CNSIM dataset contains synthetic data based on a model derived from the participants of the 1958 Birth Cohort, as part of the obesity methodological development project. This dataset does contain some NA values.\nFor the ease of this workshop, we’ll imagine that each study is hosted by a different partner of DataSHIELD: the first by UMCG Groningen (where EUCAN-Connect is based), the second by Liverpool University (where DataSHIELD core team is based) and the third by Barcelona (where ISGlobal is based). The below code creates a local R object with the login details for each study:\n\nbuilder &lt;- DSI::newDSLoginBuilder()\nbuilder$append(server = \"study1\", url = \"https://opal-demo.obiba.org\", user = \"dsuser\", password = \"P@ssw0rd\", table = \"CNSIM.CNSIM1\", driver = \"OpalDriver\", options='list(ssl_verifyhost=0, ssl_verifypeer=0)')\nbuilder$append(server = \"study2\", url = \"https://opal-demo.obiba.org\", user = \"dsuser\", password = \"P@ssw0rd\", table = \"CNSIM.CNSIM2\", driver = \"OpalDriver\", options='list(ssl_verifyhost=0, ssl_verifypeer=0)')\nbuilder$append(server = \"study3\", url = \"https://opal-demo.obiba.org\", user = \"dsuser\", password = \"P@ssw0rd\", table = \"CNSIM.CNSIM3\", driver = \"OpalDriver\", options='list(ssl_verifyhost=0, ssl_verifypeer=0)')\nlogindata &lt;- builder$build()\n\nThe error message displayed here- in production, would use https. But no need here (a self-contained environment, no risks).\nNow we need to connect, referring to the login information in the data frame we have just created:\n\nconnections &lt;- DSI::datashield.login(logins = logindata, assign = TRUE, symbol = \"D\")\n\nThe ‘assign’ argument can be set to either ‘TRUE’ or ‘FALSE’. If set to ‘TRUE’, all the available variables within that table will be assigned to a serverside data frame and available to access. If you only need a small subset of available variables it can be preferable to set this to ‘FALSE’ and later use the function ‘datashield.assign’ to separately assign only the variables you need. The output of this box has useful progress bars which show the progress of connecting to studies, one by one.\nWe can see the serverside object that has been created by running:\n\nds.ls()\n\n$study1\n$study1$environment.searched\n[1] \"R_GlobalEnv\"\n\n$study1$objects.found\n[1] \"D\"\n\n\n$study2\n$study2$environment.searched\n[1] \"R_GlobalEnv\"\n\n$study2$objects.found\n[1] \"D\"\n\n\n$study3\n$study3$environment.searched\n[1] \"R_GlobalEnv\"\n\n$study3$objects.found\n[1] \"D\"\n\n\nHere you see one dataframe in each study called ‘D’ (this name was set using the ‘symbol’ argument in datashield.login above).",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>DataSHIELD Workshop</span>"
    ]
  },
  {
    "objectID": "chapters/datashield.html#describing-data-aggregate-type-functions",
    "href": "chapters/datashield.html#describing-data-aggregate-type-functions",
    "title": "DataSHIELD Workshop",
    "section": "Describing data (‘aggregate-type functions’)",
    "text": "Describing data (‘aggregate-type functions’)\nFirst use the Opal web portal to explore the metadata of ega_phenotypes.\nGo to the url: https://opal-demo.obiba.org/ui/index.html#!project;name=CNSIM;tab=TABLES\nAnd log in using the basic analyst’s user-password combination: user / password (your browser may warn you about insecurity but again, this is not important as it is only on the local network).\nHere you will be able to check on the metadata of what you are studying, to get ideas about what commands you may want to run on which variable.\nThere are many data exploration functions already implemented into DataSHIELD: let’s check it out at the wiki https://data2knowledge.atlassian.net/wiki/spaces/DSDEV/pages/1184825438/List+of+all+DataSHIELD+functions+v6.1\nScroll down to “Data structure queries”. Let’s try out a few of these:\n\nds.dim(x=\"D\", datasources= connections)\n\n$`dimensions of D in study1`\n[1] 2163   11\n\n$`dimensions of D in study2`\n[1] 3088   11\n\n$`dimensions of D in study3`\n[1] 4128   11\n\n$`dimensions of D in combined studies`\n[1] 9379   11\n\nds.colnames(x=\"D\", datasources= connections)\n\n$study1\n [1] \"LAB_TSC\"            \"LAB_TRIG\"           \"LAB_HDL\"           \n [4] \"LAB_GLUC_ADJUSTED\"  \"PM_BMI_CONTINUOUS\"  \"DIS_CVA\"           \n [7] \"MEDI_LPD\"           \"DIS_DIAB\"           \"DIS_AMI\"           \n[10] \"GENDER\"             \"PM_BMI_CATEGORICAL\"\n\n$study2\n [1] \"LAB_TSC\"            \"LAB_TRIG\"           \"LAB_HDL\"           \n [4] \"LAB_GLUC_ADJUSTED\"  \"PM_BMI_CONTINUOUS\"  \"DIS_CVA\"           \n [7] \"MEDI_LPD\"           \"DIS_DIAB\"           \"DIS_AMI\"           \n[10] \"GENDER\"             \"PM_BMI_CATEGORICAL\"\n\n$study3\n [1] \"LAB_TSC\"            \"LAB_TRIG\"           \"LAB_HDL\"           \n [4] \"LAB_GLUC_ADJUSTED\"  \"PM_BMI_CONTINUOUS\"  \"DIS_CVA\"           \n [7] \"MEDI_LPD\"           \"DIS_DIAB\"           \"DIS_AMI\"           \n[10] \"GENDER\"             \"PM_BMI_CATEGORICAL\"\n\n\n\nWe’re going to be focus on hdl_cholesterol.\nThis is a measure of HDL Cholesterol (aka the “good cholesterol” level)\nLet’s run some summary statistic commands\n\nds.class(x='D$LAB_HDL', datasources = connections)\n\n$study1\n[1] \"numeric\"\n\n$study2\n[1] \"numeric\"\n\n$study3\n[1] \"numeric\"\n\nds.length(x='D$LAB_HDL', datasources = connections)\n\n$`length of D$LAB_HDL in study1`\n[1] 2163\n\n$`length of D$LAB_HDL in study2`\n[1] 3088\n\n$`length of D$LAB_HDL in study3`\n[1] 4128\n\n$`total length of D$LAB_HDL in all studies combined`\n[1] 9379\n\nds.mean(x='D$LAB_HDL', datasources = connections)\n\n$Mean.by.Study\n       EstimatedMean Nmissing Nvalid Ntotal\nstudy1      1.569416      360   1803   2163\nstudy2      1.556648      555   2533   3088\nstudy3      1.574687      655   3473   4128\n\n$Nstudies\n[1] 3\n\n$ValidityMessage\n       ValidityMessage \nstudy1 \"VALID ANALYSIS\"\nstudy2 \"VALID ANALYSIS\"\nstudy3 \"VALID ANALYSIS\"\n\n\nWhat is this other function to obtain the mean? Let’s use the DataSHIELD function help documentation.\n\n?ds.quantileMean\n\nNow, putting into action some of what we’ve learned about the function arguments.\n\nds.quantileMean(x='D$LAB_HDL', datasources = connections)\n\n       5%       10%       25%       50%       75%       90%       95%      Mean \n0.8678198 1.0388227 1.2998328 1.5787193 1.8481549 2.0896969 2.2302836 1.5676188 \n\nds.quantileMean(x='D$LAB_HDL',type = \"split\", datasources = connections)\n\n$study1\n      5%      10%      25%      50%      75%      90%      95%     Mean \n0.875240 1.047400 1.300000 1.581000 1.844500 2.090000 2.210900 1.569416 \n\n$study2\n      5%      10%      25%      50%      75%      90%      95%     Mean \n0.850280 1.032200 1.294000 1.563000 1.840000 2.077000 2.225000 1.556648 \n\n$study3\n      5%      10%      25%      50%      75%      90%      95%     Mean \n0.876760 1.039200 1.304000 1.589000 1.856000 2.098800 2.244200 1.574687 \n\n\nTrying to calculate the variance of HDL Cholesterol:\n\n?ds.var\n\n\nds.var(x = \"D$LAB_HDL\", type = \"split\", datasources = connections)\n\n$Variance.by.Study\n       EstimatedVar Nmissing Nvalid Ntotal\nstudy1    0.1707959      360   1803   2163\nstudy2    0.1786661      555   2533   3088\nstudy3    0.1785256      655   3473   4128\n\n$Nstudies\n[1] 3\n\n$ValidityMessage\n       ValidityMessage \nstudy1 \"VALID ANALYSIS\"\nstudy2 \"VALID ANALYSIS\"\nstudy3 \"VALID ANALYSIS\"\n\n\nCan we store the results calculated from a DataSHIELD analysis in a local R session?\nYes- the output of aggregate functions are always R objects, hence can be stored.\n\na&lt;-ds.var(x = \"D$LAB_HDL\", type = \"split\", datasources = connections)[[1]]\na\n\n       EstimatedVar Nmissing Nvalid Ntotal\nstudy1    0.1707959      360   1803   2163\nstudy2    0.1786661      555   2533   3088\nstudy3    0.1785256      655   3473   4128\n\nb&lt;-ds.var(x = \"D$LAB_HDL\", type = \"split\", datasources = connections)[[1]][[1,1]]\nb\n\n[1] 0.1707959\n\n\nThe square brackets are because we are trying to access an element of a list- which is the R object that DataSHIELD aggregate functions output as.\n\n\nUsing dsHelper to retrieve statistics in a neater format.\nAs you may have noticed, some operations which are more straightforward in R can be more complicated in datashield. To help with this, the dsHelper package allows you to do some common operations in fewer lines of code. DsHelper is an entirely serverside package - it contains only clientside functions which call DataSHIELD functions serverside.\nWe have seen datashield has a range of functions to retrieve statistics, but is limited in that (i) you need to use different functions for different statistics, (ii) you can only get stats for one variable at a time. dh.GetStats returns many useful stats in a tibble, and allows you to retrieve stats for multiple variables at a time.\n\nneat_stats &lt;- dh.getStats(\n    df = \"D\",\n  vars = c(\"LAB_TSC\", \"LAB_TRIG\", \"LAB_HDL\", \"LAB_GLUC_ADJUSTED\", \n           \"PM_BMI_CONTINUOUS\", \"DIS_CVA\", \"MEDI_LPD\", \"DIS_DIAB\", \"DIS_AMI\", \n           \"GENDER\", \"PM_BMI_CATEGORICAL\"))\n           \nneat_stats\n\n$categorical\n# A tibble: 64 × 10\n   variable cohort   category value cohort_n valid_n missing_n perc_valid\n   &lt;chr&gt;    &lt;chr&gt;    &lt;fct&gt;    &lt;int&gt;    &lt;int&gt;   &lt;int&gt;     &lt;int&gt;      &lt;dbl&gt;\n 1 DIS_CVA  combined 0         9365     9379    9379         0      99.8 \n 2 DIS_CVA  combined 1           14     9379    9379         0       0.15\n 3 DIS_CVA  combined &lt;NA&gt;         0     9379      NA        NA      NA   \n 4 DIS_DIAB combined 0         9233     9379    9379         0      98.4 \n 5 DIS_DIAB combined 1          146     9379    9379         0       1.56\n 6 DIS_DIAB combined &lt;NA&gt;         0     9379      NA        NA      NA   \n 7 GENDER   combined 0         4768     9379    9379         0      50.8 \n 8 GENDER   combined 1         4611     9379    9379         0      49.2 \n 9 GENDER   combined &lt;NA&gt;         0     9379      NA        NA      NA   \n10 MEDI_LPD combined 0         9203     9379    9379         0      98.1 \n# ℹ 54 more rows\n# ℹ 2 more variables: perc_missing &lt;dbl&gt;, perc_total &lt;dbl&gt;\n\n$continuous\n# A tibble: 20 × 15\n   variable  cohort  mean std.dev perc_5 perc_10 perc_25 perc_50 perc_75 perc_90\n   &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;\n 1 LAB_GLUC… study1  6.12    1.38   4.09    4.53    5.24    6.07    6.87    7.67\n 2 LAB_GLUC… study2  6.1     1.37   4.1     4.55    5.21    6.03    6.85    7.62\n 3 LAB_GLUC… study3  6.11    1.35   4.11    4.53    5.21    6.06    6.86    7.62\n 4 LAB_HDL   study1  1.57    0.41   0.88    1.05    1.3     1.58    1.84    2.09\n 5 LAB_HDL   study2  1.56    0.42   0.85    1.03    1.29    1.56    1.84    2.08\n 6 LAB_HDL   study3  1.57    0.42   0.88    1.04    1.3     1.59    1.86    2.1 \n 7 LAB_TRIG  study1  2.1     1.58  -0.36    0.17    1.04    2.11    3.12    4.07\n 8 LAB_TRIG  study2  2.05    1.58  -0.55    0.01    1       2.05    3.06    4.03\n 9 LAB_TRIG  study3  2.02    1.54  -0.51    0.14    1.01    2.02    3.04    3.97\n10 LAB_TSC   study1  5.87    1.11   4.09    4.49    5.11    5.86    6.59    7.31\n11 LAB_TSC   study2  5.85    1.07   4.14    4.51    5.15    5.82    6.51    7.18\n12 LAB_TSC   study3  5.85    1.07   4.2     4.58    5.11    5.79    6.51    7.26\n13 PM_BMI_C… study1 27.4     5.02  19.5    21.1    24.1    27.3    30.7    33.8 \n14 PM_BMI_C… study2 27.5     4.9   19.4    21.3    24.2    27.4    30.7    33.8 \n15 PM_BMI_C… study3 27.4     4.82  19.5    21.4    24.2    27.4    30.7    33.5 \n16 LAB_GLUC… combi…  6.11    1.37   4.1     4.54    5.22    6.05    6.86    7.63\n17 LAB_HDL   combi…  1.57    0.42   0.87    1.04    1.3     1.58    1.85    2.09\n18 LAB_TRIG  combi…  2.05    1.56  -0.49    0.1     1.01    2.05    3.06    4.01\n19 LAB_TSC   combi…  5.85    1.08   4.15    4.54    5.12    5.81    6.53    7.24\n20 PM_BMI_C… combi… 27.4     4.9   19.5    21.3    24.2    27.4    30.7    33.6 \n# ℹ 5 more variables: perc_95 &lt;dbl&gt;, valid_n &lt;dbl&gt;, cohort_n &lt;dbl&gt;,\n#   missing_n &lt;dbl&gt;, missing_perc &lt;dbl&gt;",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>DataSHIELD Workshop</span>"
    ]
  },
  {
    "objectID": "chapters/datashield.html#manipulating-data-assign-type-functions",
    "href": "chapters/datashield.html#manipulating-data-assign-type-functions",
    "title": "DataSHIELD Workshop",
    "section": "Manipulating data (‘assign-type’ functions)",
    "text": "Manipulating data (‘assign-type’ functions)\nAssign-type functions are ones where a calculation is done on the data stored at the server (and results of that calculation are “assigned” to a serverside variable, and saved there), but is NOT transmitted back to the user.\nThe reason for this is that some calculations could be highly disclosive- and if such data were transmitted to the analyst, with not much effort at all, with an inverse function, the analyst could work out exactly what the raw data are- and thus the data’s privacy is broken!\nTo demonstrate:\n\nds.ls(datasources = connections)\n\n$study1\n$study1$environment.searched\n[1] \"R_GlobalEnv\"\n\n$study1$objects.found\n[1] \"D\"\n\n\n$study2\n$study2$environment.searched\n[1] \"R_GlobalEnv\"\n\n$study2$objects.found\n[1] \"D\"\n\n\n$study3\n$study3$environment.searched\n[1] \"R_GlobalEnv\"\n\n$study3$objects.found\n[1] \"D\"\n\nds.log(x='D$LAB_HDL', newobj='LAB_HDL_log', datasources = connections)\nds.ls(datasources = connections)\n\n$study1\n$study1$environment.searched\n[1] \"R_GlobalEnv\"\n\n$study1$objects.found\n[1] \"D\"           \"LAB_HDL_log\"\n\n\n$study2\n$study2$environment.searched\n[1] \"R_GlobalEnv\"\n\n$study2$objects.found\n[1] \"D\"           \"LAB_HDL_log\"\n\n\n$study3\n$study3$environment.searched\n[1] \"R_GlobalEnv\"\n\n$study3$objects.found\n[1] \"D\"           \"LAB_HDL_log\"\n\nds.mean(x=\"LAB_HDL_log\",datasources= connections)\n\n$Mean.by.Study\n       EstimatedMean Nmissing Nvalid Ntotal\nstudy1     0.4086112      361   1802   2163\nstudy2     0.3971793      558   2530   3088\nstudy3     0.4134147      662   3466   4128\n\n$Nstudies\n[1] 3\n\n$ValidityMessage\n       ValidityMessage \nstudy1 \"VALID ANALYSIS\"\nstudy2 \"VALID ANALYSIS\"\nstudy3 \"VALID ANALYSIS\"\n\nds.mean(x=\"D$LAB_HDL\",datasources= connections)\n\n$Mean.by.Study\n       EstimatedMean Nmissing Nvalid Ntotal\nstudy1      1.569416      360   1803   2163\nstudy2      1.556648      555   2533   3088\nstudy3      1.574687      655   3473   4128\n\n$Nstudies\n[1] 3\n\n$ValidityMessage\n       ValidityMessage \nstudy1 \"VALID ANALYSIS\"\nstudy2 \"VALID ANALYSIS\"\nstudy3 \"VALID ANALYSIS\"\n\n\nThe second “ds.mean” shows that the mean of the logged values are definitely smaller, by about the right amount. The DataSHIELD log function has worked.\nThere is another DataSHIELD assign function that can be used for data transformations - a square root function. Let’s test again:\n\nds.sqrt(x='D$LAB_HDL', newobj='LAB_HDL_sqrt', datasources = connections)\nds.ls(datasources = connections)\n\n$study1\n$study1$environment.searched\n[1] \"R_GlobalEnv\"\n\n$study1$objects.found\n[1] \"D\"            \"LAB_HDL_log\"  \"LAB_HDL_sqrt\"\n\n\n$study2\n$study2$environment.searched\n[1] \"R_GlobalEnv\"\n\n$study2$objects.found\n[1] \"D\"            \"LAB_HDL_log\"  \"LAB_HDL_sqrt\"\n\n\n$study3\n$study3$environment.searched\n[1] \"R_GlobalEnv\"\n\n$study3$objects.found\n[1] \"D\"            \"LAB_HDL_log\"  \"LAB_HDL_sqrt\"\n\nds.mean(x=\"LAB_HDL_sqrt\",datasources= connections)\n\n$Mean.by.Study\n       EstimatedMean Nmissing Nvalid Ntotal\nstudy1      1.240844      361   1802   2163\nstudy2      1.235489      558   2530   3088\nstudy3      1.243899      662   3466   4128\n\n$Nstudies\n[1] 3\n\n$ValidityMessage\n       ValidityMessage \nstudy1 \"VALID ANALYSIS\"\nstudy2 \"VALID ANALYSIS\"\nstudy3 \"VALID ANALYSIS\"\n\nds.mean(x=\"D$LAB_HDL\",datasources= connections)\n\n$Mean.by.Study\n       EstimatedMean Nmissing Nvalid Ntotal\nstudy1      1.569416      360   1803   2163\nstudy2      1.556648      555   2533   3088\nstudy3      1.574687      655   3473   4128\n\n$Nstudies\n[1] 3\n\n$ValidityMessage\n       ValidityMessage \nstudy1 \"VALID ANALYSIS\"\nstudy2 \"VALID ANALYSIS\"\nstudy3 \"VALID ANALYSIS\"\n\n\nThese new objects are not attached to a dataframe. Use the help function to find out about the ds.dataFrame function, which can be used to combine objects.\nNow join “LAB_HDL_sqrt” and “LAB_HDL_log” to the dataframe “D”.\n\nds.dataFrame(c(\"D\", \"LAB_HDL_sqrt\", \"LAB_HDL_log\"), newobj = \"D\")\n\n$is.object.created\n[1] \"A data object &lt;D&gt; has been created in all specified data sources\"\n\n$validity.check\n[1] \"&lt;D&gt; appears valid in all sources\"\n\nds.colnames(\"D\")\n\n$study1\n [1] \"LAB_TSC\"            \"LAB_TRIG\"           \"LAB_HDL\"           \n [4] \"LAB_GLUC_ADJUSTED\"  \"PM_BMI_CONTINUOUS\"  \"DIS_CVA\"           \n [7] \"MEDI_LPD\"           \"DIS_DIAB\"           \"DIS_AMI\"           \n[10] \"GENDER\"             \"PM_BMI_CATEGORICAL\" \"LAB_HDL_sqrt\"      \n[13] \"LAB_HDL_log\"       \n\n$study2\n [1] \"LAB_TSC\"            \"LAB_TRIG\"           \"LAB_HDL\"           \n [4] \"LAB_GLUC_ADJUSTED\"  \"PM_BMI_CONTINUOUS\"  \"DIS_CVA\"           \n [7] \"MEDI_LPD\"           \"DIS_DIAB\"           \"DIS_AMI\"           \n[10] \"GENDER\"             \"PM_BMI_CATEGORICAL\" \"LAB_HDL_sqrt\"      \n[13] \"LAB_HDL_log\"       \n\n$study3\n [1] \"LAB_TSC\"            \"LAB_TRIG\"           \"LAB_HDL\"           \n [4] \"LAB_GLUC_ADJUSTED\"  \"PM_BMI_CONTINUOUS\"  \"DIS_CVA\"           \n [7] \"MEDI_LPD\"           \"DIS_DIAB\"           \"DIS_AMI\"           \n[10] \"GENDER\"             \"PM_BMI_CATEGORICAL\" \"LAB_HDL_sqrt\"      \n[13] \"LAB_HDL_log\"       \n\n\nUsing some of the functions above, explore the distribution of the variable “PM_BMI_CATEGORICAL” in dataframe “D”.\nHere you see this has returned a list of two tibbles separated into continuous and categorical information. For the categorical variables info is returned on ns, percentages and missingness within each category, whilst for continuous variables info is returned on mean, standard deviation, quantiles and also missingness.",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>DataSHIELD Workshop</span>"
    ]
  },
  {
    "objectID": "chapters/datashield.html#sub-setting-data",
    "href": "chapters/datashield.html#sub-setting-data",
    "title": "DataSHIELD Workshop",
    "section": "Sub-setting data",
    "text": "Sub-setting data\nIn DataSHIELD there is one function that allows sub-setting of data, ds.dataFrameSubset .\nYou may wish to use it to:\nSubset a column of data by its “Class” Subset a dataframe to remove any “NA”s Subset a numeric column of a dataframe using a Boolean inequalilty\n\n# first find the column name you wish to refer to\nds.colnames(x=\"D\")\n\n$study1\n [1] \"LAB_TSC\"            \"LAB_TRIG\"           \"LAB_HDL\"           \n [4] \"LAB_GLUC_ADJUSTED\"  \"PM_BMI_CONTINUOUS\"  \"DIS_CVA\"           \n [7] \"MEDI_LPD\"           \"DIS_DIAB\"           \"DIS_AMI\"           \n[10] \"GENDER\"             \"PM_BMI_CATEGORICAL\" \"LAB_HDL_sqrt\"      \n[13] \"LAB_HDL_log\"       \n\n$study2\n [1] \"LAB_TSC\"            \"LAB_TRIG\"           \"LAB_HDL\"           \n [4] \"LAB_GLUC_ADJUSTED\"  \"PM_BMI_CONTINUOUS\"  \"DIS_CVA\"           \n [7] \"MEDI_LPD\"           \"DIS_DIAB\"           \"DIS_AMI\"           \n[10] \"GENDER\"             \"PM_BMI_CATEGORICAL\" \"LAB_HDL_sqrt\"      \n[13] \"LAB_HDL_log\"       \n\n$study3\n [1] \"LAB_TSC\"            \"LAB_TRIG\"           \"LAB_HDL\"           \n [4] \"LAB_GLUC_ADJUSTED\"  \"PM_BMI_CONTINUOUS\"  \"DIS_CVA\"           \n [7] \"MEDI_LPD\"           \"DIS_DIAB\"           \"DIS_AMI\"           \n[10] \"GENDER\"             \"PM_BMI_CATEGORICAL\" \"LAB_HDL_sqrt\"      \n[13] \"LAB_HDL_log\"       \n\n# then check which levels you need to apply a boolean operator to:\nds.levels(x=\"D$GENDER\")\n\n$study1\n$study1$Levels\n[1] \"0\" \"1\"\n\n$study1$ValidityMessage\n[1] \"VALID ANALYSIS\"\n\n\n$study2\n$study2$Levels\n[1] \"0\" \"1\"\n\n$study2$ValidityMessage\n[1] \"VALID ANALYSIS\"\n\n\n$study3\n$study3$Levels\n[1] \"0\" \"1\"\n\n$study3$ValidityMessage\n[1] \"VALID ANALYSIS\"\n\n?ds.dataFrameSubset\n\nSplitting into GENDER groups, assigned to different server-side objects.\n\nds.dataFrameSubset(df.name = \"D\", V1.name = \"D$GENDER\", V2.name = \"1\", Boolean.operator = \"==\", newobj = \"CNSIM.subset.Males\", datasources= connections)\n\n$is.object.created\n[1] \"A data object &lt;CNSIM.subset.Males&gt; has been created in all specified data sources\"\n\n$validity.check\n[1] \"&lt;CNSIM.subset.Males&gt; appears valid in all sources\"\n\nds.dataFrameSubset(df.name = \"D\", V1.name = \"D$GENDER\", V2.name = \"0\", Boolean.operator = \"==\", newobj = \"CNSIM.subset.Females\",datasources= connections)\n\n$is.object.created\n[1] \"A data object &lt;CNSIM.subset.Females&gt; has been created in all specified data sources\"\n\n$validity.check\n[1] \"&lt;CNSIM.subset.Females&gt; appears valid in all sources\"\n\n\nNow there are two serverside objects which have split GENDER by class, to which we have assigned the names “CNSIM.subset.Males” and “CNSIM.subset.Females”.\n\nSub-setting to remove NAs\n\nds.completeCases(x1=\"D\",newobj=\"D_without_NA\", datasources=connections)\n\n$is.object.created\n[1] \"A data object &lt;D_without_NA&gt; has been created in all specified data sources\"\n\n$validity.check\n[1] \"&lt;D_without_NA&gt; appears valid in all sources\"\n\n\n\n\nSub-setting by inequality\nSay we wanted to have a subset of patients where BMI values are ≥ 25, and call it subset.BMI.25.plus\n\nds.dataFrameSubset(df.name = \"D\",\n  V1.name = \"D$PM_BMI_CONTINUOUS\",\n  V2.name = \"25\",\n  Boolean.operator = \"&gt;=\",\n  newobj = \"subset.BMI.25.plus\",\n  datasources = connections)\n\n$is.object.created\n[1] \"A data object &lt;subset.BMI.25.plus&gt; has been created in all specified data sources\"\n\n$validity.check\n[1] \"&lt;subset.BMI.25.plus&gt; appears valid in all sources\"\n\n\nChecking we have successfully created such an object, using quantiles and histograms:\n\nds.quantileMean(x=\"subset.BMI.25.plus$PM_BMI_CONTINUOUS\", type = \"split\", datasources= connections)\n\n$study1\n     5%     10%     25%     50%     75%     90%     95%    Mean \n25.3500 25.7100 27.1500 29.2000 32.0600 34.6560 36.4980 29.9019 \n\n$study2\n      5%      10%      25%      50%      75%      90%      95%     Mean \n25.46900 25.91800 27.19000 29.27000 32.20500 34.76200 36.24300 29.92606 \n\n$study3\n      5%      10%      25%      50%      75%      90%      95%     Mean \n25.43000 25.96000 27.17000 29.32000 31.94000 34.35200 36.08100 29.86534 \n\nds.histogram(x=\"subset.BMI.25.plus$PM_BMI_CONTINUOUS\", datasources = connections)\n\n[[1]]\n$breaks\n [1] 24.01061 27.23272 30.45482 33.67693 36.89903 40.12114 43.34324 46.56535\n [9] 49.78745 53.00956 56.23166\n\n$counts\n [1] 375 508 329 145  50  14   0   0   0   0\n\n$density\n [1] 0.081672661 0.110639231 0.071654147 0.031580095 0.010889688 0.003049113\n [7] 0.000000000 0.000000000 0.000000000 0.000000000\n\n$mids\n [1] 25.62166 28.84377 32.06587 35.28798 38.51008 41.73219 44.95429 48.17640\n [9] 51.39850 54.62061\n\n$xname\n[1] \"xvect\"\n\n$equidist\n[1] TRUE\n\nattr(,\"class\")\n[1] \"histogram\"\n\n[[2]]\n$breaks\n [1] 24.01061 27.23272 30.45482 33.67693 36.89903 40.12114 43.34324 46.56535\n [9] 49.78745 53.00956 56.23166\n\n$counts\n [1] 521 750 468 222  62  11   4   0   0   0\n\n$density\n [1] 0.0793013896 0.1141574706 0.0712342616 0.0337906113 0.0094370176\n [6] 0.0016743096 0.0006088398 0.0000000000 0.0000000000 0.0000000000\n\n$mids\n [1] 25.62166 28.84377 32.06587 35.28798 38.51008 41.73219 44.95429 48.17640\n [9] 51.39850 54.62061\n\n$xname\n[1] \"xvect\"\n\n$equidist\n[1] TRUE\n\nattr(,\"class\")\n[1] \"histogram\"\n\n[[3]]\n$breaks\n [1] 24.01061 27.23272 30.45482 33.67693 36.89903 40.12114 43.34324 46.56535\n [9] 49.78745 53.00956 56.23166\n\n$counts\n [1] 691 988 673 259  75  20   4   0   0   0\n\n$density\n [1] 0.0791350819 0.1131482792 0.0770736760 0.0296613404 0.0085891912\n [6] 0.0022904510 0.0004580902 0.0000000000 0.0000000000 0.0000000000\n\n$mids\n [1] 25.62166 28.84377 32.06587 35.28798 38.51008 41.73219 44.95429 48.17640\n [9] 51.39850 54.62061\n\n$xname\n[1] \"xvect\"\n\n$equidist\n[1] TRUE\n\nattr(,\"class\")\n[1] \"histogram\"\n\n\n\n\n\n\n\n\n\n\n\nSub-setting by multiple conditions\nIf we want to create a subset based on multiple conditions we can use the ds.Boole function before subsetting. For example, let’s say that we want to create a subset of individuals where BMI values are ≥ 25 and adjusted glucose is lower than 6.\n\nds.Boole(\n  V1 = \"D$PM_BMI_CONTINUOUS\",\n  V2 = \"25\",\n  Boolean.operator = \"&gt;=\",\n  numeric.output = TRUE,\n  newobj = \"BMI.25.plus\",\n  datasources = connections)\n\n$is.object.created\n[1] \"A data object &lt;BMI.25.plus&gt; has been created in all specified data sources\"\n\n$validity.check\n[1] \"&lt;BMI.25.plus&gt; appears valid in all sources\"\n\nds.Boole(\n  V1 = \"D$LAB_GLUC_ADJUSTED\",\n  V2 = \"6\",\n  Boolean.operator = \"&lt;\",\n  numeric.output = TRUE,\n  newobj = \"GLUC.6.less\",\n  datasources = connections)\n\n$is.object.created\n[1] \"A data object &lt;GLUC.6.less&gt; has been created in all specified data sources\"\n\n$validity.check\n[1] \"&lt;GLUC.6.less&gt; appears valid in all sources\"\n\n\nWe can then use the ds.make function to make a new categorical variable which combines these groups:\n\n?ds.make \n\nds.make(toAssign = \"BMI.25.plus+GLUC.6.less\",\n        newobj = \"BMI.25.plus_GLUC.6.less\",\n        datasources = connections)\n\n$is.object.created\n[1] \"A data object &lt;BMI.25.plus_GLUC.6.less&gt; has been created in all specified data sources\"\n\n$validity.check\n[1] \"&lt;BMI.25.plus_GLUC.6.less&gt; appears valid in all sources\"\n\n# If BMI &gt;= 25 and glucose &lt; 6, then BMI.25.plus_GLUC.6.less=2\n# If BMI &gt;= 25 and glucose &gt;= 6, then BMI.25.plus_GLUC.6.less=1\n# If BMI &lt; 25 and glucose &lt; 6, then BMI.25.plus_GLUC.6.less=1\n# If BMI &lt; 25 and glucose &gt;= 6, then BMI.25.plus_GLUC.6.less=0\n\nds.table(rvar= \"BMI.25.plus_GLUC.6.less\",\n         datasources = connections)\n\n\n Data in all studies were valid \n\nStudy 1 :  No errors reported from this study\nStudy 2 :  No errors reported from this study\nStudy 3 :  No errors reported from this study\n\n\n$output.list\n$output.list$TABLE_rvar.by.study_row.props\n                       study\nBMI.25.plus_GLUC.6.less    study1    study2    study3\n                     0  0.2400000 0.3293023 0.4306977\n                     1  0.2299020 0.3171569 0.4529412\n                     2  0.2259655 0.3422350 0.4317995\n                     NA 0.2329609 0.3391061 0.4279330\n\n$output.list$TABLE_rvar.by.study_col.props\n                       study\nBMI.25.plus_GLUC.6.less    study1    study2    study3\n                     0  0.1192788 0.1146373 0.1121609\n                     1  0.4336570 0.4190415 0.4476744\n                     2  0.2542765 0.2697539 0.2546027\n                     NA 0.1927878 0.1965674 0.1855620\n\n$output.list$TABLE_rvar.by.study_counts\n                       study\nBMI.25.plus_GLUC.6.less study1 study2 study3\n                     0     258    354    463\n                     1     938   1294   1848\n                     2     550    833   1051\n                     NA    417    607    766\n\n$output.list$TABLES.COMBINED_all.sources_proportions\nBMI.25.plus_GLUC.6.less\n    0     1     2    NA \n0.115 0.435 0.260 0.191 \n\n$output.list$TABLES.COMBINED_all.sources_counts\nBMI.25.plus_GLUC.6.less\n   0    1    2   NA \n1075 4080 2434 1790 \n\n\n$validity.message\n[1] \"Data in all studies were valid\"\n\nds.dataFrame(x=c(\"D\", \"BMI.25.plus_GLUC.6.less\"), newobj = \"D2\")\n\n$is.object.created\n[1] \"A data object &lt;D2&gt; has been created in all specified data sources\"\n\n$validity.check\n[1] \"&lt;D2&gt; appears valid in all sources\"\n\nds.colnames(\"D2\")\n\n$study1\n [1] \"LAB_TSC\"                 \"LAB_TRIG\"               \n [3] \"LAB_HDL\"                 \"LAB_GLUC_ADJUSTED\"      \n [5] \"PM_BMI_CONTINUOUS\"       \"DIS_CVA\"                \n [7] \"MEDI_LPD\"                \"DIS_DIAB\"               \n [9] \"DIS_AMI\"                 \"GENDER\"                 \n[11] \"PM_BMI_CATEGORICAL\"      \"LAB_HDL_sqrt\"           \n[13] \"LAB_HDL_log\"             \"BMI.25.plus_GLUC.6.less\"\n\n$study2\n [1] \"LAB_TSC\"                 \"LAB_TRIG\"               \n [3] \"LAB_HDL\"                 \"LAB_GLUC_ADJUSTED\"      \n [5] \"PM_BMI_CONTINUOUS\"       \"DIS_CVA\"                \n [7] \"MEDI_LPD\"                \"DIS_DIAB\"               \n [9] \"DIS_AMI\"                 \"GENDER\"                 \n[11] \"PM_BMI_CATEGORICAL\"      \"LAB_HDL_sqrt\"           \n[13] \"LAB_HDL_log\"             \"BMI.25.plus_GLUC.6.less\"\n\n$study3\n [1] \"LAB_TSC\"                 \"LAB_TRIG\"               \n [3] \"LAB_HDL\"                 \"LAB_GLUC_ADJUSTED\"      \n [5] \"PM_BMI_CONTINUOUS\"       \"DIS_CVA\"                \n [7] \"MEDI_LPD\"                \"DIS_DIAB\"               \n [9] \"DIS_AMI\"                 \"GENDER\"                 \n[11] \"PM_BMI_CATEGORICAL\"      \"LAB_HDL_sqrt\"           \n[13] \"LAB_HDL_log\"             \"BMI.25.plus_GLUC.6.less\"\n\nds.dataFrameSubset(df.name = \"D2\",\n  V1.name = \"D2$BMI.25.plus_GLUC.6.less\",\n  V2.name = \"2\",\n  Boolean.operator = \"==\",\n  newobj = \"subset2\",\n  datasources = connections)\n\n$is.object.created\n[1] \"A data object &lt;subset2&gt; has been created in all specified data sources\"\n\n$validity.check\n[1] \"&lt;subset2&gt; appears valid in all sources\"\n\nds.dim(\"subset2\")\n\n$`dimensions of subset2 in study1`\n[1] 550  14\n\n$`dimensions of subset2 in study2`\n[1] 833  14\n\n$`dimensions of subset2 in study3`\n[1] 1051   14\n\n$`dimensions of subset2 in combined studies`\n[1] 2434   14",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>DataSHIELD Workshop</span>"
    ]
  },
  {
    "objectID": "chapters/datashield.html#data-manipulation-with-dshelper",
    "href": "chapters/datashield.html#data-manipulation-with-dshelper",
    "title": "DataSHIELD Workshop",
    "section": "Data manipulation with dsHelper",
    "text": "Data manipulation with dsHelper\nAgain, we can use some dsHelper functions to do data manipulation operations in a more efficient way.\n\nCreate a subset of columns by a vector of column names\n\ndh.dropCols(\n    df = \"D\", \n  vars = c(\"PM_BMI_CONTINUOUS\", \"GENDER\"), \n  type = \"keep\",\n  new_obj = \"df_subset\")\n\n$study1\n$study1$is.object.created\n[1] \"A data object &lt;df_subset&gt; has been created in all specified data sources\"\n\n$study1$validity.check\n[1] \"&lt;df_subset&gt; appears valid in all sources\"\n\n\n$study2\n$study2$is.object.created\n[1] \"A data object &lt;df_subset&gt; has been created in all specified data sources\"\n\n$study2$validity.check\n[1] \"&lt;df_subset&gt; appears valid in all sources\"\n\n\n$study3\n$study3$is.object.created\n[1] \"A data object &lt;df_subset&gt; has been created in all specified data sources\"\n\n$study3$validity.check\n[1] \"&lt;df_subset&gt; appears valid in all sources\"\n\nds.colnames(\"df_subset\")\n\n$study1\n[1] \"PM_BMI_CONTINUOUS\" \"GENDER\"           \n\n$study2\n[1] \"PM_BMI_CONTINUOUS\" \"GENDER\"           \n\n$study3\n[1] \"PM_BMI_CONTINUOUS\" \"GENDER\"           \n\n\n\n\nRename variables\n(Since we are doing this for demonstration purposes, we will keep the changes in a separate dataframe, so we will first create a copy of our original dataframe \"D\" with ds.assign)\n\nds.assign(toAssign = \"D\", newobj = \"df_rename\")\n\n# Then, we rename its variables\ndh.renameVars(\n    df = \"df_rename\", \n  current_names = c(\"PM_BMI_CONTINUOUS\", \"GENDER\"),\n  new_names = c(\"BMI\", \"SEX\"))\n  \nds.colnames(\"df_rename\")\n\n$study1\n [1] \"LAB_TSC\"            \"LAB_TRIG\"           \"LAB_HDL\"           \n [4] \"LAB_GLUC_ADJUSTED\"  \"DIS_CVA\"            \"MEDI_LPD\"          \n [7] \"DIS_DIAB\"           \"DIS_AMI\"            \"PM_BMI_CATEGORICAL\"\n[10] \"LAB_HDL_sqrt\"       \"LAB_HDL_log\"        \"BMI\"               \n[13] \"SEX\"               \n\n$study2\n [1] \"LAB_TSC\"            \"LAB_TRIG\"           \"LAB_HDL\"           \n [4] \"LAB_GLUC_ADJUSTED\"  \"DIS_CVA\"            \"MEDI_LPD\"          \n [7] \"DIS_DIAB\"           \"DIS_AMI\"            \"PM_BMI_CATEGORICAL\"\n[10] \"LAB_HDL_sqrt\"       \"LAB_HDL_log\"        \"BMI\"               \n[13] \"SEX\"               \n\n$study3\n [1] \"LAB_TSC\"            \"LAB_TRIG\"           \"LAB_HDL\"           \n [4] \"LAB_GLUC_ADJUSTED\"  \"DIS_CVA\"            \"MEDI_LPD\"          \n [7] \"DIS_DIAB\"           \"DIS_AMI\"            \"PM_BMI_CATEGORICAL\"\n[10] \"LAB_HDL_sqrt\"       \"LAB_HDL_log\"        \"BMI\"               \n[13] \"SEX\"               \n\n\nThere are many more dsHelper functions designed to make common operations easier in datashield, check out the vignettes at: https://lifecycle-project.github.io/ds-helper/",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>DataSHIELD Workshop</span>"
    ]
  },
  {
    "objectID": "chapters/datashield.html#graphs",
    "href": "chapters/datashield.html#graphs",
    "title": "DataSHIELD Workshop",
    "section": "Graphs",
    "text": "Graphs\nVisualising the data we are studying is extremely important to get a sense of it. While it may seem disclosive at first glance, only such graphs that are definitively non-disclosive have been implemented within the DataSHIELD project.\n\nHistograms\nFirstly, histograms give a good sense of how one variable is distributed. But no individual points are disclosed because values are “binned” into groups of a similar magnitude, disguising what each one actually is. We protect privacy by removing bins with low counts (below specific threshold). If you have a symmetric distribution, you may find some things aren’t observed at the extreme ends.\nLet’s create a histogram of the variable we’ve been investigating for much of this study: HDL Cholesterol (“LAB_HDL”).\n\n?ds.histogram\nds.histogram(x='D$LAB_HDL', datasources = connections)\n\n[[1]]\n$breaks\n [1] -0.4974569 -0.1339306  0.2295957  0.5931220  0.9566483  1.3201746\n [7]  1.6837010  2.0472273  2.4107536  2.7742799  3.1378062\n\n$counts\n [1]   0   4  27 100 339 604 520 182  25   0\n\n$density\n [1] 0.00000000 0.00610279 0.04119383 0.15256975 0.51721144 0.92152127\n [7] 0.79336268 0.27767694 0.03814244 0.00000000\n\n$mids\n [1] -0.31569376  0.04783255  0.41135886  0.77488517  1.13841148  1.50193780\n [7]  1.86546411  2.22899042  2.59251673  2.95604304\n\n$xname\n[1] \"xvect\"\n\n$equidist\n[1] TRUE\n\nattr(,\"class\")\n[1] \"histogram\"\n\n[[2]]\n$breaks\n [1] -0.4974569 -0.1339306  0.2295957  0.5931220  0.9566483  1.3201746\n [7]  1.6837010  2.0472273  2.4107536  2.7742799  3.1378062\n\n$counts\n [1]   0   9  29 141 516 846 698 245  44   4\n\n$density\n [1] 0.000000000 0.009773981 0.031493937 0.153125695 0.560374885 0.918754172\n [7] 0.758026492 0.266069471 0.047783905 0.004343991\n\n$mids\n [1] -0.31569376  0.04783255  0.41135886  0.77488517  1.13841148  1.50193780\n [7]  1.86546411  2.22899042  2.59251673  2.95604304\n\n$xname\n[1] \"xvect\"\n\n$equidist\n[1] TRUE\n\nattr(,\"class\")\n[1] \"histogram\"\n\n[[3]]\n$breaks\n [1] -0.4974569 -0.1339306  0.2295957  0.5931220  0.9566483  1.3201746\n [7]  1.6837010  2.0472273  2.4107536  2.7742799  3.1378062\n\n$counts\n [1]    3   11   47  177  678 1127  988  385   55    0\n\n$density\n [1] 0.002376187 0.008712686 0.037226930 0.140195035 0.537018271 0.892654264\n [7] 0.782557598 0.304944003 0.043563429 0.000000000\n\n$mids\n [1] -0.31569376  0.04783255  0.41135886  0.77488517  1.13841148  1.50193780\n [7]  1.86546411  2.22899042  2.59251673  2.95604304\n\n$xname\n[1] \"xvect\"\n\n$equidist\n[1] TRUE\n\nattr(,\"class\")\n[1] \"histogram\"\n\n\n\n\n\n\n\n\n\nUse the ds.histogram to explore the distribution of “D$PM_BMI_CONTINUOUS”\n\n\nScatterplots of two numerical variables\nWhen you generate a scatter plot, you can say that the data points that are displayed are not the actual values. The function gives you the choice on how to anonymise: either you anonymise the values by additional random noise; or you take the average of the k nearest neighbours. (for more details on how anonymisation methods are used for the generation of privacy-preserving visualisations you can have a look on the paper https://epjdatascience.springeropen.com/articles/10.1140/epjds/s13688-020-00257-4)\n\nds.scatterPlot(x=\"D$LAB_HDL\", y=\"D$PM_BMI_CONTINUOUS\", datasources = connections)\n\n[1] \"Split plot created\"\n\n\n\n\n\n\n\n\n\nOther DataSHIELD graphical functions allow the creation of box plots, heatmap plots and contour plots. Investigate them using their help functions:\n\n?ds.heatmapPlot\n?ds.contourPlot\n?ds.boxPlot",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>DataSHIELD Workshop</span>"
    ]
  },
  {
    "objectID": "chapters/datashield.html#analysis",
    "href": "chapters/datashield.html#analysis",
    "title": "DataSHIELD Workshop",
    "section": "Analysis",
    "text": "Analysis\n\nSimple Linear Regression\nWe want to examine the relationship between BMI and HDL Cholesterol\n\nds.cor(x='D$PM_BMI_CONTINUOUS', y='D$LAB_HDL')\n\n$study1\n$study1$`Number of missing values in each variable`\n     x.val y.val\n[1,]    97   360\n\n$study1$`Number of missing values casewise`\n      x.val y.val\nx.val   431   431\ny.val   431   431\n\n$study1$`Correlation Matrix`\n           [,1]       [,2]\n[1,]  1.0000000 -0.1245574\n[2,] -0.1245574  1.0000000\n\n$study1$`Number of complete cases used`\n      x.val y.val\nx.val  1732  1732\ny.val  1732  1732\n\n\n$study2\n$study2$`Number of missing values in each variable`\n     x.val y.val\n[1,]   150   555\n\n$study2$`Number of missing values casewise`\n      x.val y.val\nx.val   656   656\ny.val   656   656\n\n$study2$`Correlation Matrix`\n           [,1]       [,2]\n[1,]  1.0000000 -0.1408146\n[2,] -0.1408146  1.0000000\n\n$study2$`Number of complete cases used`\n      x.val y.val\nx.val  2432  2432\ny.val  2432  2432\n\n\n$study3\n$study3$`Number of missing values in each variable`\n     x.val y.val\n[1,]   205   655\n\n$study3$`Number of missing values casewise`\n      x.val y.val\nx.val   807   807\ny.val   807   807\n\n$study3$`Correlation Matrix`\n           [,1]       [,2]\n[1,]  1.0000000 -0.1453906\n[2,] -0.1453906  1.0000000\n\n$study3$`Number of complete cases used`\n      x.val y.val\nx.val  3321  3321\ny.val  3321  3321\n\n\nRegress HDL Cholesterol with BMI using the Individual Partition Data (IPD) approach:\nThe method for this (ds.glm) is a “pooled analysis”- equivalent to placing the individual-level data from all sources in one warehouse.\nImportant to note that the link function is by default the canonical link function for each family. So binomial &lt;-&gt; logistic link, poisson &lt;-&gt; log link, gaussian &lt;-&gt; identity link.\n\nds.glm(formula = \"D$LAB_HDL~D$PM_BMI_CONTINUOUS\", family=\"gaussian\", datasources = connections)\n\n$Nvalid\n[1] 7485\n\n$Nmissing\n[1] 1894\n\n$Ntotal\n[1] 9379\n\n$disclosure.risk\n       RISK OF DISCLOSURE\nstudy1                  0\nstudy2                  0\nstudy3                  0\n\n$errorMessage\n       ERROR MESSAGES\nstudy1 \"No errors\"   \nstudy2 \"No errors\"   \nstudy3 \"No errors\"   \n\n$nsubs\n[1] 7485\n\n$iter\n[1] 3\n\n$family\n\nFamily: gaussian \nLink function: identity \n\n\n$formula\n[1] \"D$LAB_HDL ~ D$PM_BMI_CONTINUOUS\"\n\n$coefficients\n                       Estimate   Std. Error   z-value      p-value   low0.95CI\n(Intercept)          1.90261171 0.0277958082  68.44959 0.000000e+00  1.84813293\nD$PM_BMI_CONTINUOUS -0.01215774 0.0009996992 -12.16140 4.989844e-34 -0.01411711\n                     high0.95CI\n(Intercept)          1.95709049\nD$PM_BMI_CONTINUOUS -0.01019836\n\n$dev\n[1] 1297.457\n\n$df\n[1] 7483\n\n$output.information\n[1] \"SEE TOP OF OUTPUT FOR INFORMATION ON MISSING DATA AND ERROR MESSAGES\"\n\n\nRegress HDL Cholesterol with BMI using the Study-Level Meta-Analysis (SLMA) approach:\n\nds.glmSLMA(formula = \"D$LAB_HDL~D$PM_BMI_CONTINUOUS\", family=\"gaussian\", newobj = \"workshop.obj\", datasources = connections)\n\n$output.summary\n$output.summary$study1\n$output.summary$study1$rank\n[1] 2\n\n$output.summary$study1$aic\n[1] 1823.266\n\n$output.summary$study1$iter\n[1] 2\n\n$output.summary$study1$converged\n[1] TRUE\n\n$output.summary$study1$boundary\n[1] FALSE\n\n$output.summary$study1$na.action\n$output.summary$study1$na.action$na.action\n[1] \"na.omit\"\n\n\n$output.summary$study1$call\nglm(formula = formula, family = gaussian, x = TRUE)\n\n$output.summary$study1$terms\nD$LAB_HDL ~ D$PM_BMI_CONTINUOUS\nattr(,\"variables\")\nlist(D$LAB_HDL, D$PM_BMI_CONTINUOUS)\nattr(,\"factors\")\n                    D$PM_BMI_CONTINUOUS\nD$LAB_HDL                             0\nD$PM_BMI_CONTINUOUS                   1\nattr(,\"term.labels\")\n[1] \"D$PM_BMI_CONTINUOUS\"\nattr(,\"order\")\n[1] 1\nattr(,\"intercept\")\n[1] 1\nattr(,\"response\")\n[1] 1\nattr(,\".Environment\")\n&lt;environment: R_GlobalEnv&gt;\nattr(,\"predvars\")\nlist(D$LAB_HDL, D$PM_BMI_CONTINUOUS)\nattr(,\"dataClasses\")\n          D$LAB_HDL D$PM_BMI_CONTINUOUS \n          \"numeric\"           \"numeric\" \n\n$output.summary$study1$contrasts\nNULL\n\n$output.summary$study1$aliased\n        (Intercept) D$PM_BMI_CONTINUOUS \n              FALSE               FALSE \n\n$output.summary$study1$dispersion\n[1] 0.1673794\n\n$output.summary$study1$data\nNULL\n\n$output.summary$study1$df\n[1]    2 1730    2\n\n$output.summary$study1$Ntotal\n[1] 2163\n\n$output.summary$study1$Nvalid\n[1] 1732\n\n$output.summary$study1$Nmissing\n[1] 431\n\n$output.summary$study1$cov.unscaled\n                      (Intercept) D$PM_BMI_CONTINUOUS\n(Intercept)          0.0188122406       -6.660371e-04\nD$PM_BMI_CONTINUOUS -0.0006660371        2.432731e-05\n\n$output.summary$study1$cov.scaled\n                      (Intercept) D$PM_BMI_CONTINUOUS\n(Intercept)          0.0031487822       -1.114809e-04\nD$PM_BMI_CONTINUOUS -0.0001114809        4.071892e-06\n\n$output.summary$study1$offset\nNULL\n\n$output.summary$study1$weights\nNULL\n\n$output.summary$study1$VarCovMatrix\n                      (Intercept) D$PM_BMI_CONTINUOUS\n(Intercept)          0.0031487822       -1.114809e-04\nD$PM_BMI_CONTINUOUS -0.0001114809        4.071892e-06\n\n$output.summary$study1$CorrMatrix\n           [,1]       [,2]\n[1,]  1.0000000 -0.9845349\n[2,] -0.9845349  1.0000000\n\n$output.summary$study1$deviance.null\n[1] 294.1297\n\n$output.summary$study1$df.null\n[1] 1731\n\n$output.summary$study1$deviance.resid\n[1] 289.5664\n\n$output.summary$study1$df.resid\n[1] 1730\n\n$output.summary$study1$formula\nD$LAB_HDL ~ D$PM_BMI_CONTINUOUS\n\n$output.summary$study1$family\n\nFamily: gaussian \nLink function: identity \n\n\n$output.summary$study1$coefficients\n                       Estimate  Std. Error   t value      Pr(&gt;|t|)\n(Intercept)          1.86092195 0.056114010 33.163232 4.254496e-187\nD$PM_BMI_CONTINUOUS -0.01053625 0.002017893 -5.221413  1.990047e-07\n\n\n$output.summary$study2\n$output.summary$study2$rank\n[1] 2\n\n$output.summary$study2$aic\n[1] 2662.953\n\n$output.summary$study2$iter\n[1] 2\n\n$output.summary$study2$converged\n[1] TRUE\n\n$output.summary$study2$boundary\n[1] FALSE\n\n$output.summary$study2$na.action\n$output.summary$study2$na.action$na.action\n[1] \"na.omit\"\n\n\n$output.summary$study2$call\nglm(formula = formula, family = gaussian, x = TRUE)\n\n$output.summary$study2$terms\nD$LAB_HDL ~ D$PM_BMI_CONTINUOUS\nattr(,\"variables\")\nlist(D$LAB_HDL, D$PM_BMI_CONTINUOUS)\nattr(,\"factors\")\n                    D$PM_BMI_CONTINUOUS\nD$LAB_HDL                             0\nD$PM_BMI_CONTINUOUS                   1\nattr(,\"term.labels\")\n[1] \"D$PM_BMI_CONTINUOUS\"\nattr(,\"order\")\n[1] 1\nattr(,\"intercept\")\n[1] 1\nattr(,\"response\")\n[1] 1\nattr(,\".Environment\")\n&lt;environment: R_GlobalEnv&gt;\nattr(,\"predvars\")\nlist(D$LAB_HDL, D$PM_BMI_CONTINUOUS)\nattr(,\"dataClasses\")\n          D$LAB_HDL D$PM_BMI_CONTINUOUS \n          \"numeric\"           \"numeric\" \n\n$output.summary$study2$contrasts\nNULL\n\n$output.summary$study2$aliased\n        (Intercept) D$PM_BMI_CONTINUOUS \n              FALSE               FALSE \n\n$output.summary$study2$dispersion\n[1] 0.1747223\n\n$output.summary$study2$data\nNULL\n\n$output.summary$study2$df\n[1]    2 2430    2\n\n$output.summary$study2$Ntotal\n[1] 3088\n\n$output.summary$study2$Nvalid\n[1] 2432\n\n$output.summary$study2$Nmissing\n[1] 656\n\n$output.summary$study2$cov.unscaled\n                      (Intercept) D$PM_BMI_CONTINUOUS\n(Intercept)          0.0137537512       -4.863169e-04\nD$PM_BMI_CONTINUOUS -0.0004863169        1.772554e-05\n\n$output.summary$study2$cov.scaled\n                      (Intercept) D$PM_BMI_CONTINUOUS\n(Intercept)          2.403088e-03       -8.497043e-05\nD$PM_BMI_CONTINUOUS -8.497043e-05        3.097047e-06\n\n$output.summary$study2$offset\nNULL\n\n$output.summary$study2$weights\nNULL\n\n$output.summary$study2$VarCovMatrix\n                      (Intercept) D$PM_BMI_CONTINUOUS\n(Intercept)          2.403088e-03       -8.497043e-05\nD$PM_BMI_CONTINUOUS -8.497043e-05        3.097047e-06\n\n$output.summary$study2$CorrMatrix\n           [,1]       [,2]\n[1,]  1.0000000 -0.9849385\n[2,] -0.9849385  1.0000000\n\n$output.summary$study2$deviance.null\n[1] 433.1644\n\n$output.summary$study2$df.null\n[1] 2431\n\n$output.summary$study2$deviance.resid\n[1] 424.5753\n\n$output.summary$study2$df.resid\n[1] 2430\n\n$output.summary$study2$formula\nD$LAB_HDL ~ D$PM_BMI_CONTINUOUS\n\n$output.summary$study2$family\n\nFamily: gaussian \nLink function: identity \n\n\n$output.summary$study2$coefficients\n                       Estimate  Std. Error   t value      Pr(&gt;|t|)\n(Intercept)          1.89602432 0.049021297 38.677563 1.934321e-255\nD$PM_BMI_CONTINUOUS -0.01233882 0.001759843 -7.011321  3.047241e-12\n\n\n$output.summary$study3\n$output.summary$study3$rank\n[1] 2\n\n$output.summary$study3$aic\n[1] 3650.688\n\n$output.summary$study3$iter\n[1] 2\n\n$output.summary$study3$converged\n[1] TRUE\n\n$output.summary$study3$boundary\n[1] FALSE\n\n$output.summary$study3$na.action\n$output.summary$study3$na.action$na.action\n[1] \"na.omit\"\n\n\n$output.summary$study3$call\nglm(formula = formula, family = gaussian, x = TRUE)\n\n$output.summary$study3$terms\nD$LAB_HDL ~ D$PM_BMI_CONTINUOUS\nattr(,\"variables\")\nlist(D$LAB_HDL, D$PM_BMI_CONTINUOUS)\nattr(,\"factors\")\n                    D$PM_BMI_CONTINUOUS\nD$LAB_HDL                             0\nD$PM_BMI_CONTINUOUS                   1\nattr(,\"term.labels\")\n[1] \"D$PM_BMI_CONTINUOUS\"\nattr(,\"order\")\n[1] 1\nattr(,\"intercept\")\n[1] 1\nattr(,\"response\")\n[1] 1\nattr(,\".Environment\")\n&lt;environment: R_GlobalEnv&gt;\nattr(,\"predvars\")\nlist(D$LAB_HDL, D$PM_BMI_CONTINUOUS)\nattr(,\"dataClasses\")\n          D$LAB_HDL D$PM_BMI_CONTINUOUS \n          \"numeric\"           \"numeric\" \n\n$output.summary$study3$contrasts\nNULL\n\n$output.summary$study3$aliased\n        (Intercept) D$PM_BMI_CONTINUOUS \n              FALSE               FALSE \n\n$output.summary$study3$dispersion\n[1] 0.1755542\n\n$output.summary$study3$data\nNULL\n\n$output.summary$study3$df\n[1]    2 3319    2\n\n$output.summary$study3$Ntotal\n[1] 4128\n\n$output.summary$study3$Nvalid\n[1] 3321\n\n$output.summary$study3$Nmissing\n[1] 807\n\n$output.summary$study3$cov.unscaled\n                      (Intercept) D$PM_BMI_CONTINUOUS\n(Intercept)          0.0101483757       -3.600539e-04\nD$PM_BMI_CONTINUOUS -0.0003600539        1.316496e-05\n\n$output.summary$study3$cov.scaled\n                      (Intercept) D$PM_BMI_CONTINUOUS\n(Intercept)          1.781590e-03       -6.320896e-05\nD$PM_BMI_CONTINUOUS -6.320896e-05        2.311164e-06\n\n$output.summary$study3$offset\nNULL\n\n$output.summary$study3$weights\nNULL\n\n$output.summary$study3$VarCovMatrix\n                      (Intercept) D$PM_BMI_CONTINUOUS\n(Intercept)          1.781590e-03       -6.320896e-05\nD$PM_BMI_CONTINUOUS -6.320896e-05        2.311164e-06\n\n$output.summary$study3$CorrMatrix\n           [,1]       [,2]\n[1,]  1.0000000 -0.9850527\n[2,] -0.9850527  1.0000000\n\n$output.summary$study3$deviance.null\n[1] 595.2469\n\n$output.summary$study3$df.null\n[1] 3320\n\n$output.summary$study3$deviance.resid\n[1] 582.6643\n\n$output.summary$study3$df.resid\n[1] 3319\n\n$output.summary$study3$formula\nD$LAB_HDL ~ D$PM_BMI_CONTINUOUS\n\n$output.summary$study3$family\n\nFamily: gaussian \nLink function: identity \n\n\n$output.summary$study3$coefficients\n                       Estimate  Std. Error   t value     Pr(&gt;|t|)\n(Intercept)          1.92915714 0.042208881 45.705005 0.000000e+00\nD$PM_BMI_CONTINUOUS -0.01287048 0.001520251 -8.466023 3.758072e-17\n\n\n$output.summary$input.beta.matrix.for.SLMA\n                    betas study 1 betas study 2 betas study 3\n(Intercept)            1.86092195    1.89602432    1.92915714\nD$PM_BMI_CONTINUOUS   -0.01053625   -0.01233882   -0.01287048\n\n$output.summary$input.se.matrix.for.SLMA\n                    ses study 1 ses study 2 ses study 3\n(Intercept)         0.056114010 0.049021297 0.042208881\nD$PM_BMI_CONTINUOUS 0.002017893 0.001759843 0.001520251\n\n\n$num.valid.studies\n[1] 3\n\n$betamatrix.all\n                    betas study 1 betas study 2 betas study 3\n(Intercept)            1.86092195    1.89602432    1.92915714\nD$PM_BMI_CONTINUOUS   -0.01053625   -0.01233882   -0.01287048\n\n$sematrix.all\n                    ses study 1 ses study 2 ses study 3\n(Intercept)         0.056114010 0.049021297 0.042208881\nD$PM_BMI_CONTINUOUS 0.002017893 0.001759843 0.001520251\n\n$betamatrix.valid\n                    betas study 1 betas study 2 betas study 3\n(Intercept)            1.86092195    1.89602432    1.92915714\nD$PM_BMI_CONTINUOUS   -0.01053625   -0.01233882   -0.01287048\n\n$sematrix.valid\n                    ses study 1 ses study 2 ses study 3\n(Intercept)         0.056114010 0.049021297 0.042208881\nD$PM_BMI_CONTINUOUS 0.002017893 0.001759843 0.001520251\n\n$SLMA.pooled.ests.matrix\n                      pooled.ML        se.ML pooled.REML      se.REML\n(Intercept)          1.90177672 0.0277883839  1.90177672 0.0277883839\nD$PM_BMI_CONTINUOUS -0.01212642 0.0009994221 -0.01212642 0.0009994221\n                      pooled.FE        se.FE\n(Intercept)          1.90177672 0.0277883839\nD$PM_BMI_CONTINUOUS -0.01212642 0.0009994221\n\n$is.object.created\n[1] \"A data object &lt;workshop.obj&gt; has been created in all specified data sources\"\n\n$validity.check\n[1] \"&lt;workshop.obj&gt; appears valid in all sources\"\n\n\nFor the SLMA approach we can assign the predicted values at each study:\n\nds.glmPredict(glmname = \"workshop.obj\", newobj = \"workshop.prediction.obj\", datasources = connections)\n\n$study1\n$study1$safe.list\n$study1$safe.list$glm.object\n[1] \"workshop.obj\"\n\n$study1$safe.list$newdfname\nNULL\n\n$study1$safe.list$output.type\n[1] \"response\"\n\n$study1$safe.list$dispersion\nNULL\n\n$study1$safe.list$fit.Ntotal\n[1] 1732\n\n$study1$safe.list$fit.Nvalid\n[1] 1732\n\n$study1$safe.list$fit.Nmiss\n[1] 0\n\n$study1$safe.list$fit.mean\n[1] 1.572459\n\n$study1$safe.list$fit.sd\n[1] 0.2265924\n\n$study1$safe.list$fit.quantiles\n      5%      10%      25%      50%      75%      90%      95% \n1.488919 1.505439 1.538276 1.572387 1.605839 1.637659 1.655455 \n\n\n\n$study2\n$study2$safe.list\n$study2$safe.list$glm.object\n[1] \"workshop.obj\"\n\n$study2$safe.list$newdfname\nNULL\n\n$study2$safe.list$output.type\n[1] \"response\"\n\n$study2$safe.list$dispersion\nNULL\n\n$study2$safe.list$fit.Ntotal\n[1] 2432\n\n$study2$safe.list$fit.Nvalid\n[1] 2432\n\n$study2$safe.list$fit.Nmiss\n[1] 0\n\n$study2$safe.list$fit.mean\n[1] 1.557497\n\n$study2$safe.list$fit.sd\n[1] 0.243804\n\n$study2$safe.list$fit.quantiles\n      5%      10%      25%      50%      75%      90%      95% \n1.460655 1.481193 1.518580 1.557941 1.596839 1.633442 1.655954 \n\n\n\n$study3\n$study3$safe.list\n$study3$safe.list$glm.object\n[1] \"workshop.obj\"\n\n$study3$safe.list$newdfname\nNULL\n\n$study3$safe.list$output.type\n[1] \"response\"\n\n$study3$safe.list$dispersion\nNULL\n\n$study3$safe.list$fit.Ntotal\n[1] 3321\n\n$study3$safe.list$fit.Nvalid\n[1] 3321\n\n$study3$safe.list$fit.Nmiss\n[1] 0\n\n$study3$safe.list$fit.mean\n[1] 1.577157\n\n$study3$safe.list$fit.sd\n[1] 0.2481178\n\n$study3$safe.list$fit.quantiles\n      5%      10%      25%      50%      75%      90%      95% \n1.477918 1.499540 1.535707 1.576635 1.618592 1.654372 1.679084 \n\nds.length(\"workshop.prediction.obj$fit\", datasources=connections)\n\n$`length of workshop.prediction.obj$fit in study1`\n[1] 1732\n\n$`length of workshop.prediction.obj$fit in study2`\n[1] 2432\n\n$`length of workshop.prediction.obj$fit in study3`\n[1] 3321\n\n$`total length of workshop.prediction.obj$fit in all studies combined`\n[1] 7485\n\nds.length(\"D$LAB_HDL\", datasources=connections)\n\n$`length of D$LAB_HDL in study1`\n[1] 2163\n\n$`length of D$LAB_HDL in study2`\n[1] 3088\n\n$`length of D$LAB_HDL in study3`\n[1] 4128\n\n$`total length of D$LAB_HDL in all studies combined`\n[1] 9379\n\n\n\nds.cbind(c('D$LAB_HDL', 'D$PM_BMI_CONTINUOUS'), newobj='vars')\n\n$is.object.created\n[1] \"A data object &lt;vars&gt; has been created in all specified data sources\"\n\n$validity.check\n[1] \"&lt;vars&gt; appears valid in all sources\"\n\nds.completeCases('vars', newobj='vars.complete')\n\n$is.object.created\n[1] \"A data object &lt;vars.complete&gt; has been created in all specified data sources\"\n\n$validity.check\n[1] \"&lt;vars.complete&gt; appears valid in all sources\"\n\nds.dim('vars.complete')\n\n$`dimensions of vars.complete in study1`\n[1] 1732    2\n\n$`dimensions of vars.complete in study2`\n[1] 2432    2\n\n$`dimensions of vars.complete in study3`\n[1] 3321    2\n\n$`dimensions of vars.complete in combined studies`\n[1] 7485    2\n\n\nLet’s plot the best linear fit on a scatter plot\n\ndf1 &lt;- ds.scatterPlot('D$PM_BMI_CONTINUOUS', \"D$LAB_HDL\", datasources = connections, return.coords = TRUE)\ndf2 &lt;- ds.scatterPlot('vars.complete$PM_BMI_CONTINUOUS', \"workshop.prediction.obj$fit\", datasources = connections, return.coords = TRUE)\n\n\n\n\n\n\n\n# then in native R\npar(mfrow=c(2,2))\n\n\n\n\n\n\n\nplot(as.data.frame(df1[[1]][[1]])$x,as.data.frame(df1[[1]][[1]])$y, xlab='Body Mass Index', ylab='HDL Cholesterol', main='Study 1')\nlines(as.data.frame(df2[[1]][[1]])$x,as.data.frame(df2[[1]][[1]])$y, col='red')\nplot(as.data.frame(df1[[1]][[2]])$x,as.data.frame(df1[[1]][[2]])$y, xlab='Body Mass Index', ylab='HDL Cholesterol', main='Study 2')\nlines(as.data.frame(df2[[1]][[2]])$x,as.data.frame(df2[[1]][[2]])$y, col='red')\nplot(as.data.frame(df1[[1]][[3]])$x,as.data.frame(df1[[1]][[3]])$y, xlab='Body Mass Index', ylab='HDL Cholesterol', main='Study 3')\nlines(as.data.frame(df2[[1]][[3]])$x,as.data.frame(df2[[1]][[3]])$y, col='red')\n\n\n\n\n\n\n\n\nFor the SLMA approach we can also create the predicted values and the residuals at each study using the ds.make function:\n\nglmslma &lt;- ds.glmSLMA(formula = \"vars.complete$LAB_HDL~vars.complete$PM_BMI_CONTINUOUS\", family=\"gaussian\", newobj = \"workshop.obj\", datasources = connections)\n\nds.make(toAssign=paste0(\"(\",glmslma$SLMA.pooled.ests.matrix[1,1],\")+(\", glmslma$SLMA.pooled.ests.matrix[2,1],\"*vars.complete$PM_BMI_CONTINUOUS)\"), \n        newobj = \"predicted.values\")\n\n$is.object.created\n[1] \"A data object &lt;predicted.values&gt; has been created in all specified data sources\"\n\n$validity.check\n[1] \"&lt;predicted.values&gt; appears valid in all sources\"\n\nds.make(toAssign = \"vars.complete$LAB_HDL - predicted.values\", \n        newobj = \"residuals\")\n\n$is.object.created\n[1] \"A data object &lt;residuals&gt; has been created in all specified data sources\"\n\n$validity.check\n[1] \"&lt;residuals&gt; appears valid in all sources\"\n\n# and you can use those to run regression plot diagnostics  \nds.scatterPlot('predicted.values', \"residuals\", datasources = connections)\n\n[1] \"Split plot created\"\n\nds.histogram(\"residuals\", datasources = connections)\n\n\n\n\n\n\n\n\n[[1]]\n$breaks\n [1] -2.09481890 -1.74179933 -1.38877976 -1.03576019 -0.68274062 -0.32972105\n [7]  0.02329852  0.37631809  0.72933766  1.08235723  1.43537680\n\n$counts\n [1]   0   0  22  65 261 523 552 249  53   5\n\n$density\n [1] 0.000000000 0.000000000 0.035981231 0.106308181 0.426868235 0.855371980\n [7] 0.902801784 0.407242109 0.086682055 0.008177552\n\n$mids\n [1] -1.9183091 -1.5652895 -1.2122700 -0.8592504 -0.5062308 -0.1532113\n [7]  0.1998083  0.5528279  0.9058474  1.2588670\n\n$xname\n[1] \"xvect\"\n\n$equidist\n[1] TRUE\n\nattr(,\"class\")\n[1] \"histogram\"\n\n[[2]]\n$breaks\n [1] -2.09481890 -1.74179933 -1.38877976 -1.03576019 -0.68274062 -0.32972105\n [7]  0.02329852  0.37631809  0.72933766  1.08235723  1.43537680\n\n$counts\n [1]   0   6  19 106 387 767 728 336  74   9\n\n$density\n [1] 0.000000000 0.006988579 0.022130501 0.123464901 0.450763366 0.893373389\n [7] 0.847947623 0.391360442 0.086192478 0.010482869\n\n$mids\n [1] -1.9183091 -1.5652895 -1.2122700 -0.8592504 -0.5062308 -0.1532113\n [7]  0.1998083  0.5528279  0.9058474  1.2588670\n\n$xname\n[1] \"xvect\"\n\n$equidist\n[1] TRUE\n\nattr(,\"class\")\n[1] \"histogram\"\n\n[[3]]\n$breaks\n [1] -2.09481890 -1.74179933 -1.38877976 -1.03576019 -0.68274062 -0.32972105\n [7]  0.02329852  0.37631809  0.72933766  1.08235723  1.43537680\n\n$counts\n [1]    0    8   30  123  507  986 1052  493  112    8\n\n$density\n [1] 0.000000000 0.006823738 0.025589017 0.104914968 0.432454382 0.841025682\n [7] 0.897321519 0.420512841 0.095532329 0.006823738\n\n$mids\n [1] -1.9183091 -1.5652895 -1.2122700 -0.8592504 -0.5062308 -0.1532113\n [7]  0.1998083  0.5528279  0.9058474  1.2588670\n\n$xname\n[1] \"xvect\"\n\n$equidist\n[1] TRUE\n\nattr(,\"class\")\n[1] \"histogram\"\n\n\n\n\n\n\n\n\n\n\n\nCreating forest plots\nWe want to examine the relationship between BMI and diabetes\nExamine the distribution of the variable “DIS_DIAB” in all cohorts using ‘ds.table’:\n\nds.table(\"D$DIS_DIAB\")\n\n\n Data in all studies were valid \n\nStudy 1 :  No errors reported from this study\nStudy 2 :  No errors reported from this study\nStudy 3 :  No errors reported from this study\n\n\n$output.list\n$output.list$TABLE_rvar.by.study_row.props\n          study\nD$DIS_DIAB    study1    study2    study3\n        0  0.2310192 0.3293621 0.4396188\n        1  0.2054795 0.3219178 0.4726027\n        NA       NaN       NaN       NaN\n\n$output.list$TABLE_rvar.by.study_col.props\n          study\nD$DIS_DIAB     study1     study2     study3\n        0  0.98613037 0.98477979 0.98328488\n        1  0.01386963 0.01522021 0.01671512\n        NA 0.00000000 0.00000000 0.00000000\n\n$output.list$TABLE_rvar.by.study_counts\n          study\nD$DIS_DIAB study1 study2 study3\n        0    2133   3041   4059\n        1      30     47     69\n        NA      0      0      0\n\n$output.list$TABLES.COMBINED_all.sources_proportions\nD$DIS_DIAB\n     0      1     NA \n0.9840 0.0156 0.0000 \n\n$output.list$TABLES.COMBINED_all.sources_counts\nD$DIS_DIAB\n   0    1   NA \n9233  146    0 \n\n\n$validity.message\n[1] \"Data in all studies were valid\"\n\n\nCheck the class of “DIS_DIAB”:\n\nds.class(\"D$DIS_DIAB\")\n\n$study1\n[1] \"factor\"\n\n$study2\n[1] \"factor\"\n\n$study3\n[1] \"factor\"\n\n\nExamine the association between BMI and diabetes:\n\nglmSLMA_mod2&lt;-ds.glmSLMA(formula=\"D$DIS_DIAB~D$PM_BMI_CONTINUOUS\", family='binomial')\n\nSave effect estimates and standard errors as new objects\n\nestimates &lt;- c(glmSLMA_mod2$betamatrix.valid[2,])\nse &lt;- c(glmSLMA_mod2$sematrix.valid[2,])\n\nMeta-analyse the results using rma to obtain study weights:\n\nres &lt;- rma(estimates, sei=se)\n\nCan produce simple forest plots using output:\n\nforest(res, atransf=exp)\n\n\n\n\n\n\n\n\nWe can also add more information to forest plots:\n\nstudy_names &lt;- c(\"study 1\", \"study 2\", \"study 3\")\nweights &lt;-  c(paste0(formatC(weights(res), format=\"f\", digits=1, width=4), \"%\"))\n\nforest(res, atransf=exp,\n       xlab=\"Crude Odds Ratio\", refline=log(1), xlim=c(-0.25,0.5), at=log(c(0.95, 1, 1.1, 1.2, 1.3)),\n       slab=cbind(paste0(study_names, \" (\", paste0(weights, \")\"))), mlab=\"RE model\")\ntext(0.5, 4.5, pos=2, \"Odds Ratio [95% CI]\")\ntext(-0.25, 4.5, pos=4, \"Study (weight)\")\n\n\n\n\n\n\n\n\n\n\nModelling multiple variables and interactions\nAlso possible to model multiple explanatory variables and include interactions:\n\nglm_mod1&lt;-ds.glm(formula=\"D$DIS_DIAB~D$PM_BMI_CONTINUOUS+D$LAB_HDL*D$GENDER\", family='binomial', datasources = connections)\n\nThe “*” between LAB_HDL and GENDER means fit all possible main effects and interactions between the two covariates.\nCompare with results of a study-level meta analysis:\n\nglmSLMA_mod2&lt;-ds.glmSLMA(formula=\"D$DIS_DIAB~D$PM_BMI_CONTINUOUS+D$LAB_HDL*D$GENDER\", family='binomial')\n\nNow compare outputs:\n\nglm_mod1$coefficients\n\n                      Estimate Std. Error   z-value      p-value low0.95CI.LP\n(Intercept)         -6.4227455 0.77703028 -8.265760 1.388081e-16  -7.94569683\nD$PM_BMI_CONTINUOUS  0.1294283 0.02101243  6.159607 7.292573e-10   0.08824471\nD$LAB_HDL           -0.9912007 0.25745856 -3.849943 1.181455e-04  -1.49581021\nD$GENDER1           -1.5610343 0.77864285 -2.004814 4.498290e-02  -3.08714627\nD$LAB_HDL:D$GENDER1  0.7971705 0.49668192  1.604992 1.084956e-01  -0.17630817\n                    high0.95CI.LP        P_OR low0.95CI.P_OR high0.95CI.P_OR\n(Intercept)           -4.89979410 0.001621557   0.0003540576     0.007393052\nD$PM_BMI_CONTINUOUS    0.17061192 1.138177517   1.0922553714     1.186030387\nD$LAB_HDL             -0.48659119 0.371130805   0.2240669893     0.614718282\nD$GENDER1             -0.03492239 0.209918833   0.0456319902     0.965680359\nD$LAB_HDL:D$GENDER1    1.77064918 2.219252675   0.8383595883     5.874665842\n\nglmSLMA_mod2$SLMA.pooled.ests.matrix\n\n                     pooled.ML      se.ML pooled.REML    se.REML  pooled.FE\n(Intercept)         -6.4534338 0.78157668  -6.4534338 0.78157668 -6.4534338\nD$PM_BMI_CONTINUOUS  0.1291349 0.02114524   0.1291349 0.02114524  0.1291349\nD$LAB_HDL           -0.9873823 0.25787450  -0.9873823 0.25787450 -0.9873823\nD$GENDER1           -1.5166315 0.78378855  -1.5166315 0.78378855 -1.5166315\nD$LAB_HDL:D$GENDER1  0.7738504 0.49963906   0.7738504 0.49963906  0.7738504\n                         se.FE\n(Intercept)         0.78157668\nD$PM_BMI_CONTINUOUS 0.02114524\nD$LAB_HDL           0.25787450\nD$GENDER1           0.78378855\nD$LAB_HDL:D$GENDER1 0.49963906\n\n\nSimilar, but differences between the results are accounted for by the different techniques employed.",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>DataSHIELD Workshop</span>"
    ]
  },
  {
    "objectID": "chapters/datashield.html#at-the-end-of-your-rstudio-server-analysis",
    "href": "chapters/datashield.html#at-the-end-of-your-rstudio-server-analysis",
    "title": "DataSHIELD Workshop",
    "section": "At the end of your RStudio Server analysis:",
    "text": "At the end of your RStudio Server analysis:\nYou can save your workspace:\n\nDSI::datashield.workspace_save(conns = connections, ws = \"workspace2025\")\n\nDon’t forget to log out! Using:\n\nDSI::datashield.logout(connections)\n\nYou can restore your workspace, the next time you want to continue with your analysis\n\nconnections &lt;- datashield.login(logins = logindata, assign = TRUE, symbol = \"D\")\nds.ls()\n\n$study1\n$study1$environment.searched\n[1] \"R_GlobalEnv\"\n\n$study1$objects.found\n[1] \"D\"\n\n\n$study2\n$study2$environment.searched\n[1] \"R_GlobalEnv\"\n\n$study2$objects.found\n[1] \"D\"\n\n\n$study3\n$study3$environment.searched\n[1] \"R_GlobalEnv\"\n\n$study3$objects.found\n[1] \"D\"\n\ndatashield.logout(connections)\n\nconnections &lt;- datashield.login(logins = logindata, restore = \"workspace2025\")\nds.ls()\n\n$study1\n$study1$environment.searched\n[1] \"R_GlobalEnv\"\n\n$study1$objects.found\n [1] \"BMI.25.plus\"             \"BMI.25.plus_GLUC.6.less\"\n [3] \"CNSIM.subset.Females\"    \"CNSIM.subset.Males\"     \n [5] \"D\"                       \"D_without_NA\"           \n [7] \"D2\"                      \"df_rename\"              \n [9] \"df_subset\"               \"DIS_DIAB\"               \n[11] \"GENDER\"                  \"GLUC.6.less\"            \n[13] \"LAB_HDL\"                 \"LAB_HDL_log\"            \n[15] \"LAB_HDL_sqrt\"            \"new.glm.obj\"            \n[17] \"ONES\"                    \"PM_BMI_CONTINUOUS\"      \n[19] \"predicted.values\"        \"residuals\"              \n[21] \"subset.BMI.25.plus\"      \"subset2\"                \n[23] \"vars\"                    \"vars.complete\"          \n[25] \"workshop.obj\"            \"workshop.prediction.obj\"\n\n\n$study2\n$study2$environment.searched\n[1] \"R_GlobalEnv\"\n\n$study2$objects.found\n [1] \"BMI.25.plus\"             \"BMI.25.plus_GLUC.6.less\"\n [3] \"CNSIM.subset.Females\"    \"CNSIM.subset.Males\"     \n [5] \"D\"                       \"D_without_NA\"           \n [7] \"D2\"                      \"df_rename\"              \n [9] \"df_subset\"               \"DIS_DIAB\"               \n[11] \"GENDER\"                  \"GLUC.6.less\"            \n[13] \"LAB_HDL\"                 \"LAB_HDL_log\"            \n[15] \"LAB_HDL_sqrt\"            \"new.glm.obj\"            \n[17] \"ONES\"                    \"PM_BMI_CONTINUOUS\"      \n[19] \"predicted.values\"        \"residuals\"              \n[21] \"subset.BMI.25.plus\"      \"subset2\"                \n[23] \"vars\"                    \"vars.complete\"          \n[25] \"workshop.obj\"            \"workshop.prediction.obj\"\n\n\n$study3\n$study3$environment.searched\n[1] \"R_GlobalEnv\"\n\n$study3$objects.found\n [1] \"BMI.25.plus\"             \"BMI.25.plus_GLUC.6.less\"\n [3] \"CNSIM.subset.Females\"    \"CNSIM.subset.Males\"     \n [5] \"D\"                       \"D_without_NA\"           \n [7] \"D2\"                      \"df_rename\"              \n [9] \"df_subset\"               \"DIS_DIAB\"               \n[11] \"GENDER\"                  \"GLUC.6.less\"            \n[13] \"LAB_HDL\"                 \"LAB_HDL_log\"            \n[15] \"LAB_HDL_sqrt\"            \"new.glm.obj\"            \n[17] \"ONES\"                    \"PM_BMI_CONTINUOUS\"      \n[19] \"predicted.values\"        \"residuals\"              \n[21] \"subset.BMI.25.plus\"      \"subset2\"                \n[23] \"vars\"                    \"vars.complete\"          \n[25] \"workshop.obj\"            \"workshop.prediction.obj\"\n\n\nAlso you can delete unwanted workspaces using the datashield.workspace_rm\nIn Rstudio Server: DON’T forget to use the orange “quit the current R session” button (top right of browser screen) before closing the tab- otherwise you will experience an error message the next time you try to log in.",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>DataSHIELD Workshop</span>"
    ]
  },
  {
    "objectID": "chapters/dsomop.html",
    "href": "chapters/dsomop.html",
    "title": "dsOMOP Workshop",
    "section": "",
    "text": "INFORMATION FOR NEWCOMERS TO RSTUDIO NOTEBOOKS:\nThis is an R Markdown Notebook. When you execute code within the notebook, the results appear beneath the code. Here you can download the .Rmd file to reproduce this bookdown using RStudio (in case the download does not work, right click on the link and select “Save link as…”). You can also copy and paste the R code available in every step.\nTry executing each chunk by clicking the Run button within the chunk or by placing your cursor inside it and pressing Ctrl+Shift+Enter.\nIn this lesson, we will learn how to:\n\nSet up the required dependencies and connect to a DataSHIELD server\nCreate an interface object to interact with an OMOP database\nExplore the available data and identify the concepts of interest\nRetrieve data from the OMOP database using the interface object\nExplore the retrieved data and manipulate it using DataSHIELD functions\nCreate cohort definitions using DataSHIELD functions to filter the data\nPerform a practical example of an analysis integrating the retrieved data into the DataSHIELD workflow\n\n\n\nRecommended background knowledge\nBefore using dsOMOP, it is recommended to have a basic understanding of:\n\nThe OMOP CDM structure and its standardized clinical data format. You can learn more about OMOP CDM in the OHDSI Book chapter ‘The Common Data Model’.\nOMOP Vocabularies and how they standardize medical concepts (like diagnoses, medications, procedures) across different coding systems (ICD-9, ICD-10, SNOMED CT, etc.) into a common representation. The OHDSI Book chapter ‘Standardized Vocabularies’ provides a comprehensive overview of this standardization process.\nBasic DataSHIELD concepts and workflow. The DataSHIELD Beginner’s Tutorial is a good starting point.\nFor more information about the dsOMOP framework, you can visit the dsOMOP website.\n\nThis knowledge will help you better understand how to effectively query and work with OMOP CDM data through the DataSHIELD infrastructure.\n\n\nInitial setup\nFor this exercise, we will use the following libraries:\n\nlibrary(DSI)\nlibrary(DSOpal)\nlibrary(dsBaseClient)\nlibrary(dsOMOPClient)\nlibrary(dsOMOPHelper)\nlibrary(dsHelper)\n\nWe will establish a connection to the demo Opal server. In order to use the OMOP packages and have access to the OMOP database resources, we need to specify the profile = \"omop\" parameter in the login builder:\n\nbuilder &lt;- newDSLoginBuilder()\nbuilder$append(server=\"opal-demo\",\n              url=\"https://opal-demo.obiba.org/\",\n              user=\"dsuser\",\n              password=\"P@ssw0rd\",\n              driver = \"OpalDriver\",\n              profile = \"omop\")\n\nlogindata &lt;- builder$build()\nconns &lt;- datashield.login(logins=logindata)\n\n\n\nCreating an OMOP database interface object\nWe will create an OMOP database interface object using the ds.omop.helper function. This interface object provides a set of methods for easily interacting with an OMOP database.\nIn our case, we will use the mimiciv resource inside the omop_demo project, which points to a small sample database formatted in OMOP CDM:\n\nhelper &lt;- ds.omop.helper(\n    connections = conns,\n    resource = \"omop_demo.mimiciv\", \n    symbol = \"mimiciv\"\n)\n\nThis will create both the object helper which will assist us in the creation of our desired dataset, and parallely a table in the server side called mimiciv (since this is the name we specified in the symbol parameter) which will contain the data that we import from the OMOP database.\nWe can check the list of objects available in the server side using the ds.ls function:\n\nds.ls()\n\n$`opal-demo`\n$`opal-demo`$environment.searched\n[1] \"R_GlobalEnv\"\n\n$`opal-demo`$objects.found\n[1] \"mimiciv\"\n\n\nAs we can observe, mimiciv has been successfully created in the server side. We can check the current state of the mimiciv table in the server side at any time using the ds.summary function:\n\nds.summary(\"mimiciv\")\n\n$`opal-demo`\n$`opal-demo`$class\n[1] \"data.frame\"\n\n$`opal-demo`$`number of rows`\n[1] 100\n\n$`opal-demo`$`number of columns`\n[1] 5\n\n$`opal-demo`$`variables held`\n[1] \"person_id\"            \"gender_concept_id\"    \"year_of_birth\"       \n[4] \"race_concept_id\"      \"ethnicity_concept_id\"\n\n\nThe mimiciv table initially contains only the person table, as that is the nexus table in the OMOP CDM. This allows us to append data from other tables since all pieces of information are linked to the person table, since it is the table that contains the patient identifiers.\nNow it is time to retrieve more data and add it to the mimiciv object using the helper interface object! But first, we need to explore our database to plan the data retrieval.\n\n\nData exploration\nThe first step is to identify the data that is available in the OMOP database. We can check the available tables using the tables method. The table structure should usually one that matches one version of the OMOP CDM (in our case, the mimiciv database is formatted in the OMOP CDM 5.4. This commonly provides a good starting point to understand the structure of our data:\n\nhelper$tables()\n\n$`opal-demo`\n [1] \"attribute_definition\" \"care_site\"            \"cdm_source\"          \n [4] \"cohort\"               \"cohort_attribute\"     \"cohort_definition\"   \n [7] \"concept\"              \"concept_relationship\" \"condition_era\"       \n[10] \"condition_occurrence\" \"cost\"                 \"death\"               \n[13] \"device_exposure\"      \"dose_era\"             \"drug_era\"            \n[16] \"drug_exposure\"        \"fact_relationship\"    \"location\"            \n[19] \"measurement\"          \"metadata\"             \"note\"                \n[22] \"note_nlp\"             \"observation\"          \"observation_period\"  \n[25] \"payer_plan_period\"    \"person\"               \"procedure_occurrence\"\n[28] \"provider\"             \"specimen\"             \"visit_detail\"        \n[31] \"visit_occurrence\"     \"vocabulary\"          \n\n\nAs expected, the mimiciv database presents the structure of the OMOP CDM 5.4:\n\n\n\nOMOP CDM v5.4 schema\n\n\nWe can also check the columns available in each table using the columns method. These should match the columns available in the OMOP CDM documentation for the specific version of the CDM that the database is formatted in. This information is also available in the OMOP CDM documentation, but is a good reminder of the structure of the data.\nLet’s check the columns available in the condition_occurrence, measurement and observation tables:\n\nhelper$columns(\"condition_occurrence\")\n\n$`opal-demo`\n$`opal-demo`$condition_occurrence\n [1] \"condition_occurrence_id\"       \"person_id\"                    \n [3] \"condition_concept_id\"          \"condition_start_date\"         \n [5] \"condition_start_datetime\"      \"condition_end_date\"           \n [7] \"condition_end_datetime\"        \"condition_type_concept_id\"    \n [9] \"stop_reason\"                   \"provider_id\"                  \n[11] \"visit_occurrence_id\"           \"visit_detail_id\"              \n[13] \"condition_source_value\"        \"condition_source_concept_id\"  \n[15] \"condition_status_source_value\" \"condition_status_concept_id\"  \n\n\n\nhelper$columns(\"measurement\")\n\n$`opal-demo`\n$`opal-demo`$measurement\n [1] \"measurement_id\"                \"person_id\"                    \n [3] \"measurement_concept_id\"        \"measurement_date\"             \n [5] \"measurement_datetime\"          \"measurement_time\"             \n [7] \"measurement_type_concept_id\"   \"operator_concept_id\"          \n [9] \"value_as_number\"               \"value_as_concept_id\"          \n[11] \"unit_concept_id\"               \"range_low\"                    \n[13] \"range_high\"                    \"provider_id\"                  \n[15] \"visit_occurrence_id\"           \"visit_detail_id\"              \n[17] \"measurement_source_value\"      \"measurement_source_concept_id\"\n[19] \"unit_source_value\"             \"value_source_value\"           \n\n\n\nhelper$columns(\"observation\")\n\n$`opal-demo`\n$`opal-demo`$observation\n [1] \"observation_id\"                \"person_id\"                    \n [3] \"observation_concept_id\"        \"observation_date\"             \n [5] \"observation_datetime\"          \"observation_type_concept_id\"  \n [7] \"value_as_number\"               \"value_as_string\"              \n [9] \"value_as_concept_id\"           \"qualifier_concept_id\"         \n[11] \"unit_concept_id\"               \"provider_id\"                  \n[13] \"visit_occurrence_id\"           \"visit_detail_id\"              \n[15] \"observation_source_value\"      \"observation_source_concept_id\"\n[17] \"unit_source_value\"             \"qualifier_source_value\"       \n\n\nNow that we have a good understanding of the structure of the data we are working with, we should identify the concepts that we are interested in. Bear in mind that the OMOP CDM is designed to be used in a wide range of contexts, and therefore the concepts that are present in a database will be specific to the context of the database.\nConcepts are the building blocks of the OMOP CDM. They are used to represent the entities that are present in the database, and are based on clinical vocabularies. For the sake of standardization, concepts are represented by numerical IDs matched to terms in clinical vocabularies. For example, the concept “Chronic obstructive lung disease” is stored as concept ID 255573 in the OMOP CDM, and it is represented by this identifier across the whole database.\nWe can explore the concepts available in the OMOP CDM through Athena, the central repository of standardized clinical vocabularies used in the OMOP CDM. Athena provides a web interface to search and browse concepts across different vocabularies and domains.\nHowever, we can also use the concepts method to retrieve the concepts available in the database. This method will return a list of concept IDs present in a table, linked to the official concept name designed to it.\nLet’s check the concepts available in the condition_occurrence, measurement and observation tables:\n\ncondition_list &lt;- helper$concepts(\"condition_occurrence\")\ncondition_list\n\n$`opal-demo`\n    concept_id                                                 concept_name\n1        27674                                          Nausea and vomiting\n2        29735                                         Candidiasis of mouth\n3        31317                                                    Dysphagia\n4        73553                                                  Arthropathy\n5        75576                                     Irritable bowel syndrome\n6        75860                                                 Constipation\n7        77670                                                   Chest pain\n8        78232                                          Shoulder joint pain\n9        79864                                           Hematuria syndrome\n10       80180                                               Osteoarthritis\n11       80502                                                 Osteoporosis\n12       80951                               Candidiasis of urogenital site\n13       81611                                Diverticular disease of colon\n14       81902                             Urinary tract infectious disease\n15      132736                                                   Bacteremia\n16      132797                                                       Sepsis\n17      134736                                                     Backache\n18      134765                                                     Cachexia\n19      138384                                      Acquired hypothyroidism\n20      140673                                               Hypothyroidism\n21      192357                                              Paralytic ileus\n22      192450                                           Retention of urine\n23      192671                                  Gastrointestinal hemorrhage\n24      192673                          Vascular insufficiency of intestine\n25      192680                                          Portal hypertension\n26      193688                           Clostridioides difficile infection\n27      193782                                      End-stage renal disease\n28      195306                                             Gastroduodenitis\n29      195562                                                  Hemorrhoids\n30      195581                                          Peritoneal adhesion\n31      196236                                                 Septic shock\n32      196463                                          Alcoholic cirrhosis\n33      196523                                                     Diarrhea\n34      197320                                          Acute kidney injury\n35      197444                        Vascular complication of medical care\n36      197494                                            Viral hepatitis C\n37      197672                                         Urinary incontinence\n38      197925                                Hemorrhage of rectum and anus\n39      197950                              Cellulitis and abscess of trunk\n40      198571                                            Cardiogenic shock\n41      198678                                Intestinal infectious disease\n42      198964                                          Chronic hepatitis C\n43      199074                                           Acute pancreatitis\n44      200219                                               Abdominal pain\n45      200451                          Chronic passive congestion of liver\n46      200528                                                      Ascites\n47      200618                                          Postoperative shock\n48      201061                                         Diaphragmatic hernia\n49      201826                                     Type 2 diabetes mellitus\n50      254061                                             Pleural effusion\n51      255573                             Chronic obstructive lung disease\n52      255848                                                    Pneumonia\n53      259992                              Ventilator associated pneumonia\n54      261600                                        Acute pulmonary edema\n55      261880                                                  Atelectasis\n56      313217                                          Atrial fibrillation\n57      314054                                        Aortic valve disorder\n58      314665                                               Atrial flutter\n59      314666                                    Old myocardial infarction\n60      315078                                                 Palpitations\n61      315286                               Chronic ischemic heart disease\n62      315831                              Chronic pulmonary heart disease\n63      316135                                       Atrioventricular block\n64      316139                                                Heart failure\n65      317002                                           Low blood pressure\n66      317003                                          Compression of vein\n67      317009                                                       Asthma\n68      317576                                    Coronary arteriosclerosis\n69      318736                                                     Migraine\n70      318772                                      Disorder of pericardium\n71      318800                              Gastroesophageal reflux disease\n72      319041                                      Orthostatic hypotension\n73      319049                                    Acute respiratory failure\n74      319835                                     Congestive heart failure\n75      319843                                        Mitral valve disorder\n76      319844                                 Acute ischemic heart disease\n77      320128                                       Essential hypertension\n78      321052                                  Peripheral vascular disease\n79      321462                                         Cardiac complication\n80      321887                                           Disorder of artery\n81      372448                                        Loss of consciousness\n82      372887                                            Disorder of brain\n83      372892                                     Metabolic encephalopathy\n84      373764                                         Toxic encephalopathy\n85      373995                                                     Delirium\n86      375519                                           Alcohol withdrawal\n87      376690                                               Cerebral edema\n88      376713                                          Cerebral hemorrhage\n89      377091                                                      Seizure\n90      378253                                                     Headache\n91      380378                                                     Epilepsy\n92      432545                                 Bacterial infectious disease\n93      432585                                   Blood coagulation disorder\n94      432867                                               Hyperlipidemia\n95      432870                                    Thrombocytopenic disorder\n96      432875                             Anemia due to chronic blood loss\n97      432881                                                 Pancytopenia\n98      433163                                 Deficiency of macronutrients\n99      433736                                                      Obesity\n100     433753                                                Alcohol abuse\n101     433968                                                  Candidiasis\n102     434004                                                 Hypervolemia\n103     434056                      Late effects of cerebrovascular disease\n104     434547                           Complication of surgical procedure\n105     434610                                                 Hyperkalemia\n106     434814        Late effect of medical and surgical care complication\n107     434894                                 Acute posthemorrhagic anemia\n108     435243                                           Alcohol dependence\n109     435515                          Hypo-osmolality and or hyponatremia\n110     435517                                                     Acidosis\n111     435788                            Disorder of phosphorus metabolism\n112     435796                                                  Dehydration\n113     435829                             Rheumatic disease of heart valve\n114     436073                                           Psychotic disorder\n115     436096                                                 Chronic pain\n116     436222                                        Altered mental status\n117     436238 Elevated level of transaminase and lactic acid dehydrogenase\n118     436659                                       Iron deficiency anemia\n119     436676                                Posttraumatic stress disorder\n120     436962                                                     Insomnia\n121     437233                                             Multiple myeloma\n122     437247                                    Anemia of chronic disease\n123     437264                                  Tobacco dependence syndrome\n124     437312                                                     Bleeding\n125     437382                                                Urine finding\n126     437390                                                    Hypoxemia\n127     437474                                      Postoperative infection\n128     437579                           Paroxysmal ventricular tachycardia\n129     437663                                                        Fever\n130     437779                             Streptococcal infectious disease\n131     437827                                    Pure hypercholesterolemia\n132     437833                                                  Hypokalemia\n133     438064                       Bacterial infection due to Pseudomonas\n134     438398                                                 Leukocytosis\n135     438725                             Disorder of magnesium metabolism\n136     438730                                                    Alkalosis\n137     439005                              Chronic alcoholism in remission\n138     439408                                          Graft complications\n139     439696 Hypertensive heart and renal disease with (congestive) he...\n140     439777                                                       Anemia\n141     440320                            Infection due to Escherichia coli\n142     440383                                          Depressive disorder\n143     440424                                                      Aphasia\n144     440530                                      Oropharyngeal dysphagia\n145     440674                                                         Gout\n146     440940        Methicillin resistant Staphylococcus aureus infection\n147     441258                                 Anemia in neoplastic disease\n148     441536                             Mixed acid-base balance disorder\n149     441829                         Hyperosmolality and or hypernatremia\n150     442019                                    Complication of procedure\n151     442077                                             Anxiety disorder\n152     442588                             Obstructive sleep apnea syndrome\n153     443211        Benign prostatic hyperplasia with outflow obstruction\n154     443238                                      Diabetic - poor control\n155     443344                                          Barrett's esophagus\n156     443447                                       Iatrogenic hypotension\n157     443530                                                 Hematochezia\n158     443597                               Chronic kidney disease stage 3\n159     443612                               Chronic kidney disease stage 4\n160     443734                 Ketoacidosis due to type 2 diabetes mellitus\n161     444044                                       Acute tubular necrosis\n162     444070                                                  Tachycardia\n163     444100                                                Mood disorder\n164     444101                                   Hypertensive heart failure\n165     444406                              Acute subendocardial infarction\n166     764123   Atherosclerosis of coronary artery without angina pectoris\n167    4008576                       Diabetes mellitus without complication\n168    4052648                                                   Disability\n169    4064161                                           Cirrhosis of liver\n170    4064452                                     ECG: atrial fibrillation\n171    4065288                                          EKG: atrial flutter\n172    4079687                                         Tumor lysis syndrome\n173    4088998                                 AV sequential pacing pattern\n174    4089488                                        Atrial pacing pattern\n175    4092038                                   Ventricular pacing pattern\n176    4094822                            Foreign body in respiratory tract\n177    4101362                                      Finding of urine output\n178    4126119                                            Toxic nephropathy\n179    4138456                                       ECG: sinus bradycardia\n180    4140598                                       ECG: sinus tachycardia\n181    4141820                                        ECG: sinus arrhythmia\n182    4144111          Gastroesophageal reflux disease without esophagitis\n183    4145510                            EKG: supraventricular tachycardia\n184    4145513                                            ECG: sinus rhythm\n185    4150981                                              Drug resistance\n186    4154290                               Paroxysmal atrial fibrillation\n187    4175154                    Disorder of the peripheral nervous system\n188    4182210                                                     Dementia\n189    4187218                         Pneumonitis due to inhaled substance\n190    4188331                                      Chronic pulmonary edema\n191    4193704                Type 2 diabetes mellitus without complication\n192    4209423                                          Nicotine dependence\n193    4229440                             Chronic congestive heart failure\n194    4232495                                       Primary cardiomyopathy\n195    4233565 Severe protein-calorie malnutrition (Gomez: less than 60 ...\n196    4245975                                              Hepatic failure\n197    4256228                                          Respiratory failure\n198    4268911                                                Disorientated\n199    4270024         Acute non-ST segment elevation myocardial infarction\n200    4282096                             Major depression, single episode\n201    4286201                                     Schizoaffective disorder\n202    4295261                                         Postmenopausal state\n203    4311499              Primary malignant neoplasm of respiratory tract\n204    4322175                    Late effect of complications of procedure\n205    4332246                                                     Aneurysm\n206    4339214                             Secondary pulmonary hypertension\n207    4353709                               Intracerebral vascular finding\n208   36712779                   Chronic total occlusion of coronary artery\n209   36712821                                     Postprocedural infection\n210   36712982 Unstable angina co-occurrent and due to coronary arterios...\n211   37016114               Acute on chronic hypoxemic respiratory failure\n212   37016349                Hyperglycemia due to type 2 diabetes mellitus\n213   37017432               Polyneuropathy due to type 2 diabetes mellitus\n214   37116361                            Accidental wound during procedure\n215   37311319                                                  Hypovolemia\n216   37394658                                                Severe sepsis\n217   37395564                                Hypoxemic respiratory failure\n218   40321716                                   Secondary thrombocytopenia\n219   40479192                               Chronic systolic heart failure\n220   40479576                              Chronic diastolic heart failure\n221   40480602                      Acute on chronic systolic heart failure\n222   40481043                     Acute on chronic diastolic heart failure\n223   40481762         Hemiplegia as late effect of cerebrovascular disease\n224   40481919                                     Coronary atherosclerosis\n225   40482801                       Type II diabetes mellitus uncontrolled\n226   40487064                               Sepsis due to Escherichia coli\n227   42537730                                Coronary artery graft present\n228   42537748                                    Acquired absence of organ\n229   42873170                            Dependence on supplemental oxygen\n230   43022062              Cardiovascular system complication of procedure\n231   43530681                                      Drug abuse in remission\n232   43530690                   Foot ulcer due to type 2 diabetes mellitus\n233   43530742 Paralytic syndrome on one side of the body as late effect...\n234   43531578       Chronic kidney disease due to type 2 diabetes mellitus\n235   44782421              Acute deep venous thrombosis of upper extremity\n236   44782429                   Chronic kidney disease due to hypertension\n237   44784217                                           Cardiac arrhythmia\n238   44784439         Benign hypertensive renal disease with renal failure\n239   44784631                               Pain due to neoplastic disease\n240   45757363                 Hypoglycemia due to type 2 diabetes mellitus\n241   45766207       Non-rheumatic mitral valve stenosis with regurgitation\n242   45768812                             Anemia in chronic kidney disease\n243   45768910                                         Uncomplicated asthma\n244   46271022                                       Chronic kidney disease\n245   46271075                          Acute hypoxemic respiratory failure\n246   46273390                                     Dependence on respirator\n\n\n\nmeasurement_list &lt;- helper$concepts(\"measurement\")\nmeasurement_list\n\n$`opal-demo`\n    concept_id                                                 concept_name\n1            0                                          No matching concept\n2      1175625                                      Breath rate spontaneous\n3      3000067           Parathyrin.intact [Mass/volume] in Serum or Plasma\n4      3000068                                oxyCODONE [Presence] in Urine\n5      3000099            Nuclear Ab [Units/volume] in Serum by Immunoassay\n6      3000285                               Sodium [Moles/volume] in Blood\n7      3000330                      Specific gravity of Urine by Test strip\n8      3000348         Leukocyte esterase [Presence] in Urine by Test strip\n9      3000456           Dacrocytes [Presence] in Blood by Light microscopy\n10     3000461                          Pressure support setting Ventilator\n11     3000483                               Glucose [Mass/volume] in Blood\n12     3000593     Cobalamin (Vitamin B12) [Mass/volume] in Serum or Plasma\n13     3000764                          Benzodiazepines [Presence] in Urine\n14     3000941            Linezolid [Susceptibility] by Disk diffusion (KB)\n15     3000963                            Hemoglobin [Mass/volume] in Blood\n16     3001122                    Ferritin [Mass/volume] in Serum or Plasma\n17     3001308         Cholesterol in LDL [Moles/volume] in Serum or Plasma\n18     3001318            Cholesterol.total/Cholesterol in HDL [Percentile]\n19     3001494 Erythrocytes [#/volume] in Urine sediment by Microscopy h...\n20     3001582                     Protein/Creatinine [Mass Ratio] in Urine\n21     3001893                  Eosinophils/100 leukocytes in Pleural fluid\n22     3001950             Amikacin [Susceptibility] by Disk diffusion (KB)\n23     3002020                             Barbiturates [Presence] in Urine\n24     3002091         Choriogonadotropin [Moles/volume] in Serum or Plasma\n25     3002113  Variant lymphocytes [Presence] in Blood by Light microscopy\n26     3002179                       Metamyelocytes/100 leukocytes in Blood\n27     3002331                    Protein [Mass/volume] in Peritoneal fluid\n28     3002400                        Iron [Mass/volume] in Serum or Plasma\n29     3002827        Microalbumin/Creatinine [Mass Ratio] in 24 hour Urine\n30     3002850         Tetracycline [Susceptibility] by Disk diffusion (KB)\n31     3002888              Erythrocyte distribution width [Entitic volume]\n32     3003105           Gentamicin [Susceptibility] by Disk diffusion (KB)\n33     3003132            Barbiturates [Presence] in Serum, Plasma or Blood\n34     3003181                               Sodium [Moles/volume] in Urine\n35     3003282               Leukocytes [#/volume] in Blood by Manual count\n36     3003396                 Base excess in Arterial blood by calculation\n37     3003403                       Glucose [Mass/volume] in Pleural fluid\n38     3003434                       Protein [Mass/volume] in Pleural fluid\n39     3003709                  Acetaminophen [Presence] in Serum or Plasma\n40     3003785         Carcinoembryonic Ag [Mass/volume] in Serum or Plasma\n41     3003906            Oxacillin [Susceptibility] by Disk diffusion (KB)\n42     3004249                                      Systolic blood pressure\n43     3004295                         Urea nitrogen [Mass/volume] in Blood\n44     3004297                                      Temperature Inhaled gas\n45     3004327           Lymphocytes [#/volume] in Blood by Automated count\n46     3004354            ceFAZolin [Susceptibility] by Disk diffusion (KB)\n47     3004410                     Hemoglobin A1c/Hemoglobin.total in Blood\n48     3004501                     Glucose [Mass/volume] in Serum or Plasma\n49     3004588              Protein electrophoresis panel - Serum or Plasma\n50     3004698                                     QRS duration in lead III\n51     3004905        Lipase [Enzymatic activity/volume] in Serum or Plasma\n52     3004921                                  Ventilation mode Ventilator\n53     3005087     Macrophages/100 leukocytes in Body fluid by Manual count\n54     3005131 Glucose mean value [Mass/volume] in Blood Estimated from ...\n55     3005158          Clindamycin [Susceptibility] by Disk diffusion (KB)\n56     3005309                    Salicylates [Presence] in Serum or Plasma\n57     3005456                            Potassium [Moles/volume] in Blood\n58     3005481          Spherocytes [Presence] in Blood by Light microscopy\n59     3005555                              Left ventricular Cardiac output\n60     3005606                     Pulmonary artery Systolic blood pressure\n61     3005629                                     Inhaled oxygen flow rate\n62     3005686           Bite cells [Presence] in Blood by Light microscopy\n63     3005715                  Vancomycin [Mass/volume] in Serum or Plasma\n64     3005719                         IgG [Mass/volume] in Serum or Plasma\n65     3005854           Burr cells [Presence] in Blood by Light microscopy\n66     3005897                 Protein [Mass/volume] in Urine by Test strip\n67     3006122            Meropenem [Susceptibility] by Disk diffusion (KB)\n68     3006135   Nucleated erythrocytes [#/volume] in Blood by Manual count\n69     3006175       Mucus [Presence] in Urine sediment by Light microscopy\n70     3006490 Calcium oxalate crystals [Presence] in Urine sediment by ...\n71     3006923 Alanine aminotransferase [Enzymatic activity/volume] in S...\n72     3007070          Cholesterol in HDL [Mass/volume] in Serum or Plasma\n73     3007124   Reticulocytes/100 erythrocytes in Blood by Automated count\n74     3007164                         IgA [Mass/volume] in Serum or Plasma\n75     3007220 Creatine kinase [Enzymatic activity/volume] in Serum or P...\n76     3007350 Amorphous sediment [Presence] in Urine sediment by Light ...\n77     3007359          Bilirubin.indirect [Mass/volume] in Serum or Plasma\n78     3007469                               Breath rate setting Ventilator\n79     3007733                             Chloride [Moles/volume] in Urine\n80     3007794                                                 P-R Interval\n81     3007876                                          Appearance of Urine\n82     3007913         Alveolar-arterial oxygen Partial pressure difference\n83     3008223                                     Glasgow coma score motor\n84     3008251                          Bicarbonate [Moles/volume] in Urine\n85     3008295                                Osmolality of Serum or Plasma\n86     3008308         Erythromycin [Susceptibility] by Disk diffusion (KB)\n87     3008449                                 S wave amplitude in lead III\n88     3008504           Vancomycin [Susceptibility] by Disk diffusion (KB)\n89     3008598         Thyroxine (T4) free [Mass/volume] in Serum or Plasma\n90     3008691      Amylase [Enzymatic activity/volume] in Peritoneal fluid\n91     3008855          Leukocytes other/100 leukocytes in Peritoneal fluid\n92     3008939    Band form neutrophils [#/volume] in Blood by Manual count\n93     3009094                                    Glasgow coma score verbal\n94     3009201                Thyrotropin [Units/volume] in Serum or Plasma\n95     3009306         Alpha-1-Fetoprotein [Mass/volume] in Serum or Plasma\n96     3009314             Cefepime [Susceptibility] by Disk diffusion (KB)\n97     3009497                                              Type of GI tube\n98     3009542                        Hematocrit [Volume Fraction] of Blood\n99     3009613                  Erythrocytes [#/volume] in Peritoneal fluid\n100    3009682                    Cortisol [Mass/volume] in Serum or Plasma\n101    3009744                        MCHC [Mass/volume] by Automated count\n102    3010189 Epithelial cells [#/area] in Urine sediment by Microscopy...\n103    3010321                              Right eye Pupil diameter Manual\n104    3010340       Triiodothyronine (T3) [Mass/volume] in Serum or Plasma\n105    3010421                                                  pH of Blood\n106    3010834                Platelets [#/volume] in Blood by Manual count\n107    3011335                     Digoxin [Mass/volume] in Serum or Plasma\n108    3011368       Poikilocytosis [Presence] in Blood by Light microscopy\n109    3011397                 Hemoglobin [Presence] in Urine by Test strip\n110    3011483 Granular casts [#/area] in Urine sediment by Microscopy l...\n111    3011544                       Albumin [Mass/volume] in Pleural fluid\n112    3011589                                 T wave amplitude in lead III\n113    3011904                   Phosphate [Mass/volume] in Serum or Plasma\n114    3011965                         Urea nitrogen [Mass/volume] in Urine\n115    3011987        Polychromasia [Presence] in Blood by Light microscopy\n116    3012030                        MCH [Entitic mass] by Automated count\n117    3012095                  Magnesium [Moles/volume] in Serum or Plasma\n118    3012222 Trimethoprim+Sulfamethoxazole [Susceptibility] by Disk di...\n119    3012336                 Haptoglobin [Mass/volume] in Serum or Plasma\n120    3012410                              Tidal volume setting Ventilator\n121    3012501                          Base excess in Blood by calculation\n122    3012516                               Albumin [Mass/volume] in Urine\n123    3012888                                     Diastolic blood pressure\n124    3012986 Erythrocytes [#/volume] in Cerebral spinal fluid by Autom...\n125    3013290                   Carbon dioxide [Partial pressure] in Blood\n126    3013429             Basophils [#/volume] in Blood by Automated count\n127    3013466                           aPTT in Blood by Coagulation assay\n128    3013502                                   Oxygen saturation in Blood\n129    3013603        Prostate specific Ag [Mass/volume] in Serum or Plasma\n130    3013650           Neutrophils [#/volume] in Blood by Automated count\n131    3013678 Triglyceride [Mass/volume] in Serum or Plasma --12 hours ...\n132    3013682               Urea nitrogen [Mass/volume] in Serum or Plasma\n133    3013707          Erythrocyte sedimentation rate by Westergren method\n134    3013721 Aspartate aminotransferase [Enzymatic activity/volume] in...\n135    3013731 Hepatitis B virus surface Ab [Units/volume] in Serum or P...\n136    3014080                       Oxygen gas flow Oxygen delivery system\n137    3014576                   Chloride [Moles/volume] in Serum or Plasma\n138    3014886           Neutrophils [#/volume] in Urine by Automated count\n139    3015273                                         Consistency of Stool\n140    3015280                   Blasts [#/volume] in Blood by Manual count\n141    3015377                    Calcium [Moles/volume] in Serum or Plasma\n142    3015536                          ST amplitude.J point+80 ms Lead III\n143    3015862         levoFLOXacin [Susceptibility] by Disk diffusion (KB)\n144    3016038                            Potassium [Moles/volume] in Urine\n145    3016242 Piperacillin+Tazobactam [Susceptibility] by Disk diffusio...\n146    3016251              Hemoglobin.gastrointestinal [Presence] in Stool\n147    3016293                Bicarbonate [Moles/volume] in Serum or Plasma\n148    3016311  Creatine kinase.MB/Creatine kinase.total in Serum or Plasma\n149    3016335                               Glasgow coma score eye opening\n150    3016407 Fibrinogen [Mass/volume] in Platelet poor plasma by Coagu...\n151    3016502                          Oxygen saturation in Arterial blood\n152    3016557 Hepatitis B virus core Ab [Units/volume] in Serum by Immu...\n153    3016573 Ampicillin+Sulbactam [Susceptibility] by Disk diffusion (KB)\n154    3016723                  Creatinine [Mass/volume] in Serum or Plasma\n155    3016750                                 Collection duration of Urine\n156    3016771       Amylase [Enzymatic activity/volume] in Serum or Plasma\n157    3016879                                  Cocaine [Presence] in Urine\n158    3016991              Thyroxine (T4) [Mass/volume] in Serum or Plasma\n159    3017143                     Hepatitis C virus Ab [Presence] in Serum\n160    3017181                           Myelocytes/100 leukocytes in Blood\n161    3017188                    Pulmonary artery Diastolic blood pressure\n162    3017250                            Creatinine [Mass/volume] in Urine\n163    3017400                            Magnesium [Moles/volume] in Urine\n164    3017594                     Tidal volume.spontaneous --on ventilator\n165    3017595           Ampicillin [Susceptibility] by Disk diffusion (KB)\n166    3018053                                  S wave duration in lead III\n167    3018405                     Lactate [Moles/volume] in Arterial blood\n168    3018465                      Oxygen saturation in Mixed venous blood\n169    3018572                             Chloride [Moles/volume] in Blood\n170    3018672                                             pH of Body fluid\n171    3018760 Blood smear finding [Identifier] in Blood by Light micros...\n172    3018834            Bilirubin.total [Presence] in Urine by Test strip\n173    3018954      Choriogonadotropin (pregnancy test) [Presence] in Urine\n174    3019298               Eosinophils/100 leukocytes in Peritoneal fluid\n175    3019351                           QRS terminal amplitude in lead III\n176    3019416         Acanthocytes [Presence] in Blood by Light microscopy\n177    3019473               Protein [Mass/volume] in Cerebral spinal fluid\n178    3019510 Hepatitis B virus surface Ag [Presence] in Serum or Plasm...\n179    3019550                     Sodium [Moles/volume] in Serum or Plasma\n180    3019634 Microscopic observation [Identifier] in Tissue by Wright ...\n181    3019761  Pappenheimer bodies [Presence] in Blood by Light microscopy\n182    3019800          Troponin T.cardiac [Mass/volume] in Serum or Plasma\n183    3019880         Schistocytes [Presence] in Blood by Light microscopy\n184    3019897    Erythrocyte distribution width [Ratio] by Automated count\n185    3019977                                         pH of Arterial blood\n186    3020149        25-hydroxyvitamin D3 [Mass/volume] in Serum or Plasma\n187    3020153        Ciprofloxacin [Susceptibility] by Disk diffusion (KB)\n188    3020416          Erythrocytes [#/volume] in Blood by Automated count\n189    3020460          C reactive protein [Mass/volume] in Serum or Plasma\n190    3020481                                           Respiration rhythm\n191    3020630                     Protein [Mass/volume] in Serum or Plasma\n192    3020716                                 Inhaled oxygen concentration\n193    3020891                                             Body temperature\n194    3021044       Iron binding capacity [Mass/volume] in Serum or Plasma\n195    3021119                      Calcium.ionized [Moles/volume] in Blood\n196    3021200 Thyroglobulin Ab [Units/volume] in Serum by Radioimmunoas...\n197    3021303          Hypochromia [Presence] in Blood by Light microscopy\n198    3021453                     Eosinophils/100 leukocytes in Body fluid\n199    3021502           Macrocytes [Presence] in Blood by Light microscopy\n200    3021595                      Phenytoin [Presence] in Serum or Plasma\n201    3021601                    Nitrite [Presence] in Urine by Test strip\n202    3021886                              Globulin [Mass/volume] in Serum\n203    3022022                                                 QRS duration\n204    3022094           Tobramycin [Susceptibility] by Disk diffusion (KB)\n205    3022217             INR in Platelet poor plasma by Coagulation assay\n206    3022318                                            Heart rate rhythm\n207    3022509 Hyaline casts [#/area] in Urine sediment by Microscopy lo...\n208    3022548               Glucose [Mass/volume] in Cerebral spinal fluid\n209    3022621                                    pH of Urine by Test strip\n210    3022747          cefTRIAXone [Susceptibility] by Disk diffusion (KB)\n211    3022797                                 R wave amplitude in lead III\n212    3022875          Positive end expiratory pressure setting Ventilator\n213    3023103                  Potassium [Moles/volume] in Serum or Plasma\n214    3023307         Penicillin G [Susceptibility] by Disk diffusion (KB)\n215    3023314     Hematocrit [Volume Fraction] of Blood by Automated count\n216    3023520                            Reticulocytes [#/volume] in Blood\n217    3023539                 Ketones [Mass/volume] in Urine by Test strip\n218    3023547                Leukocytes other/100 leukocytes in Body fluid\n219    3023599                      MCV [Entitic volume] by Automated count\n220    3024128             Bilirubin.total [Mass/volume] in Serum or Plasma\n221    3024153            Promyelocytes [#/volume] in Blood by Manual count\n222    3024171                                             Respiratory rate\n223    3024561                     Albumin [Mass/volume] in Serum or Plasma\n224    3024629                 Glucose [Mass/volume] in Urine by Test strip\n225    3024882        Oxygen/Total gas setting [Volume Fraction] Ventilator\n226    3024929             Platelets [#/volume] in Blood by Automated count\n227    3025019                           Gas flow Respiratory system airway\n228    3025255 Bacteria [#/area] in Urine sediment by Microscopy high po...\n229    3025315                                                  Body weight\n230    3025439 Airway pressure Ventilator --at peak inspiratory flow max...\n231    3025478      Tricyclic antidepressants [Presence] in Serum or Plasma\n232    3025616         Target cells [Presence] in Blood by Light microscopy\n233    3025809                                                 Q-T interval\n234    3026256                            QRS initial amplitude in lead III\n235    3026258                                       Q-T interval corrected\n236    3026314         Anisocytosis [Presence] in Blood by Light microscopy\n237    3026400                        Ethanol [Presence] in Serum or Plasma\n238    3026611                               Left eye Pupil diameter Manual\n239    3026692                    Albumin [Mass/volume] in Peritoneal fluid\n240    3026729                             Phosphate [Mass/volume] in Urine\n241    3026782                                          Osmolality of Urine\n242    3026904 Basophilic stippling [Presence] in Blood by Light microscopy\n243    3026910 Gamma glutamyl transferase [Enzymatic activity/volume] in...\n244    3027008                                  Opiates [Presence] in Urine\n245    3027018                                                   Heart rate\n246    3027114                 Cholesterol [Mass/volume] in Serum or Plasma\n247    3027162                                               Color of Urine\n248    3027315                           Oxygen [Partial pressure] in Blood\n249    3027597            Bilirubin.direct [Mass/volume] in Serum or Plasma\n250    3027598                                          Mean blood pressure\n251    3027801                  Oxygen [Partial pressure] in Arterial blood\n252    3027920           Ovalocytes [Presence] in Blood by Light microscopy\n253    3027944                             Amphetamines [Presence] in Urine\n254    3027946          Carbon dioxide [Partial pressure] in Arterial blood\n255    3028026                         IgM [Mass/volume] in Serum or Plasma\n256    3028074                         Pulmonary artery Mean blood pressure\n257    3028308                     Erythrocytes [#/volume] in Pleural fluid\n258    3028437          Cholesterol in LDL [Mass/volume] in Serum or Plasma\n259    3028468            Fragments [Presence] in Blood by Light microscopy\n260    3028561                                  R wave duration in lead III\n261    3028615           Eosinophils [#/volume] in Blood by Automated count\n262    3028662 Hepatitis A virus Ab [Units/volume] in Serum or Plasma by...\n263    3029187 Natriuretic peptide.B prohormone N-Terminal [Mass/volume]...\n264    3031147 Carbon dioxide, total [Moles/volume] in Blood by calculation\n265    3031951                          Benzodiazepines [Presence] in Blood\n266    3033364                   Cholesterol [Mass/volume] in Pleural fluid\n267    3033483                 Monocytes/100 leukocytes in Peritoneal fluid\n268    3033575             Monocytes [#/volume] in Blood by Automated count\n269    3034426                                        Prothrombin time (PT)\n270    3035206                               Physical mobility Braden scale\n271    3035359                          ST amplitude.J point+60 ms Lead III\n272    3035583 Leukocytes [#/area] in Urine sediment by Microscopy high ...\n273    3035816                        Nutrition intake pattern Braden scale\n274    3035851 Transitional cells [#/area] in Urine sediment by Microsco...\n275    3035995 Alkaline phosphatase [Enzymatic activity/volume] in Serum...\n276    3036098                              Sensory perception Braden scale\n277    3036180                                Methadone [Presence] in Urine\n278    3036277                                                  Body height\n279    3036354         Leukocytes other [#/volume] in Blood by Manual count\n280    3036518                               Left ventricular Stroke volume\n281    3036987                      Folate [Mass/volume] in Serum or Plasma\n282    3037022                               Moisture exposure Braden scale\n283    3037153             rifAMPin [Susceptibility] by Disk diffusion (KB)\n284    3037185                                  Protein [Presence] in Urine\n285    3037244 Yeast [#/area] in Urine sediment by Microscopy high power...\n286    3037274    HIV 1 Ab [Units/volume] in Serum or Plasma by Immunoassay\n287    3037278                               Anion gap 4 in Serum or Plasma\n288    3037318                               Physical activity Braden scale\n289    3037347                              Friction and shear Braden scale\n290    3037426               Urobilinogen [Presence] in Urine by Test strip\n291    3037490                                               Color of Stool\n292    3037556                       Urate [Mass/volume] in Serum or Plasma\n293    3037577            Monocytes/100 leukocytes in Cerebral spinal fluid\n294    3037663 Carbon dioxide, total [Moles/volume] in Arterial blood by...\n295    3037871 Macrophages/100 leukocytes in Cerebral spinal fluid by Ma...\n296    3037885           Microcytes [Presence] in Blood by Light microscopy\n297    3038047       Nitrofurantoin [Susceptibility] by Disk diffusion (KB)\n298    3038086          cefTAZidime [Susceptibility] by Disk diffusion (KB)\n299    3038104                       Monocytes/100 leukocytes in Body fluid\n300    3038288 Influenza virus B RNA [Presence] in Specimen by NAA with ...\n301    3039000                                           Anion gap in Blood\n302    3040168                    Immature granulocytes [#/volume] in Blood\n303    3041079 Nucleated cells [#/volume] in Pleural fluid by Automated ...\n304    3041372 Nucleated cells [#/volume] in Cerebral spinal fluid by Au...\n305    3041408 Nucleated cells [#/volume] in Peritoneal fluid by Automat...\n306    3041635 Macrophages/100 leukocytes in Peritoneal fluid by Manual ...\n307    3042347                                           Dressing for Wound\n308    3043387                    Monocytes/100 leukocytes in Pleural fluid\n309    3043728   WBC casts [Presence] in Urine sediment by Light microscopy\n310    3043970                                                Color of Skin\n311    3044938 Influenza virus A RNA [Presence] in Specimen by NAA with ...\n312    3046838                                                   Edema site\n313    3047181                              Lactate [Moles/volume] in Blood\n314    3051714     Fibrin D-dimer FEU [Mass/volume] in Platelet poor plasma\n315    4024509                                                Urine culture\n316    4024510                                Microbial culture, body fluid\n317    4035228                                Respiratory microbial culture\n318    4036044                                  Anaerobic microbial culture\n319    4107893                                                Blood culture\n320    4165398                                             Mycology culture\n321    4189544                                            Microbial culture\n322    4247906                                  Clostridium difficile assay\n323    4265595                                  Creatine kinase measurement\n324    4300293                                               Tissue culture\n325   21490516                        Inspiration [Time] Respiratory system\n326   21490580       Carbon dioxide production (VCO2) in Respiratory system\n327   21490650  Pressure max Respiratory system airway --during inspiration\n328   21490675                                Central venous pressure (CVP)\n329   21490712                               Left ventricular Cardiac index\n330   21490753                 Volume expired per minute Respiratory system\n331   21490854                      Tidal volume Ventilator --on ventilator\n332   21490880                         Left ventricular Stroke volume index\n333   21490888                               PCA lockout time Infusion pump\n334   21490963                               Right pupil Pupillary response\n335   21491186                                   Endotracheal tube Diameter\n336   21491763                                Left pupil Pupillary response\n337   21492239                       Systolic blood pressure by Noninvasive\n338   21492240                      Diastolic blood pressure by Noninvasive\n339   21492241                           Mean blood pressure by Noninvasive\n340   21492838                                               Skin integrity\n341   21494965                                               Passing flatus\n342   21494966                    Physical findings of Abdomen by Palpation\n343   36203862                                              Color of Sputum\n344   36303946   Pressure.plateau Respiratory system airway --on ventilator\n345   36684829                            Richmond Agitation-Sedation Scale\n346   40760766       Tidal volume.inspired maximum setting Ventilator alarm\n347   40762499        Oxygen saturation in Arterial blood by Pulse oximetry\n348   40762903                              Apnea interval Ventilator alarm\n349   40763080 Lactate dehydrogenase [Enzymatic activity/volume] in Peri...\n350   42527086                                         Mean airway pressure\n351   42527140                                Total PEEP Respiratory system\n352   43055270                                           Wound closure type\n353   46236952 Glomerular filtration rate/1.73 sq M.predicted [Volume Ra...\n\n\n\nobservation_list &lt;- helper$concepts(\"observation\")\nobservation_list\n\n$`opal-demo`\n   concept_id                                                 concept_name\n1      432789                            Opioid analgesic adverse reaction\n2      433942                 Accident while engaged in household activity\n3      435928                                         Abnormal weight loss\n4      436583                                                         Fall\n5      438046 Medical accident to patient during surgical and medical care\n6      439996                               Anticoagulant adverse reaction\n7      440279                                                     Accident\n8      440922                                          Diabetic on insulin\n9      440927                             High risk drug monitoring status\n10     441207                                     Adverse reaction to drug\n11     441749                              Fall on or from stairs or steps\n12    2617452                       Hospital observation service, per hour\n13    3001062                                      History of Past illness\n14    3007397                                              Ventilator type\n15    3012697                                       History of Tobacco use\n16    3024265                            Body temperature measurement site\n17    3034263                                     Pain severity - Reported\n18    3039006                                              Oral care given\n19    4005823                                                 Tobacco user\n20    4014023                                              Palliative care\n21    4019967                                 Dependence on renal dialysis\n22    4036936                                              Oxygen delivery\n23    4060705                           Body mass index 25-29 - overweight\n24    4060985                                Body mass index 30+ - obesity\n25    4119499                                        Not for resuscitation\n26    4127294                                         Resuscitation status\n27    4135421                               Body mass index 20-24 - normal\n28    4138763                                 Acceptable pain level status\n29    4139934                                                     Homeless\n30    4140830                                           Fall on same level\n31    4143274                           History of cerebrovascular disease\n32    4148407                                   FH: Cardiovascular disease\n33    4162219       Patient transfer to postoperative anesthesia care unit\n34    4167217                           Family history of clinical finding\n35    4179242                        History of malignant neoplasm of skin\n36    4180749                    History of malignant neoplasm of prostate\n37    4182335                     Family history of ischemic heart disease\n38    4192791                                  Pain management (specialty)\n39    4203722                                  Patient encounter procedure\n40    4214956                       History of clinical finding in subject\n41    4215685                                    Past history of procedure\n42    4233464                           Legal physical restraint performed\n43    4256640                         Body mass index 40+ - severely obese\n44    4265599                      Patient transfer to intensive care unit\n45    4276526                                             Cigarette smoker\n46    4279614                                                 Asphyxiation\n47    4296248                                             Cost containment\n48    4311079       Place of occurrence of accident or poisoning, hospital\n49    4314870                 Place of occurrence of accident or poisoning\n50    4323345                                              History of fall\n51    4324190                      History of malignant neoplasm of breast\n52    4337265                                                 Bowel sounds\n53   21492835                                           Respiratory effort\n54   36717001                             Long-term current use of aspirin\n55   37116693                                      Stroke volume variation\n56   40479553                                    Cardiac pacemaker in situ\n57   40757693                          Indicators of pain or possible pain\n58   40758030                                           Preferred language\n59   40766231                                      Marital status [NHANES]\n60   46235654                                            Primary insurance\n61   46272450                        Long-term current use of drug therapy\n62   46272451                             Long-term current use of insulin\n63   46272666                            Coordination of family conference\n64   46273928                                         Liaising with family\n65   46273937                       Long-term current use of anticoagulant\n66   46274064                       History of antineoplastic chemotherapy\n\n\nThese serve as concept catalogs for each table. We can explore them to identify the concepts that are present in the database.\nFor example, as an exercise, let’s find the concept IDs for:\n\nChronic obstructive lung disease\nAsthma\nSystolic blood pressure\nHeart rate\nTobacco user\n\nNote: For convenience, we can save these concept catalogs as files for easy reference, sharing with collaborators, and future consultation. For example, we can save them as CSV files:\n\n# Create a data directory if it doesn't exist\ndir.create(\"data\", showWarnings = FALSE)\n\n# Save the concept catalogs as CSV files\nwrite.csv(condition_list, file = \"data/condition_list.csv\")\nwrite.csv(measurement_list, file = \"data/measurement_list.csv\")\nwrite.csv(observation_list, file = \"data/observation_list.csv\")\n\nDid you find the concepts that we are looking for?\n\n\n\n\n\n\nClick to see the solution\n\n\n\n\n\nLet’s search for these concepts in our catalogs:\n\nSystolic blood pressure: 3004249\n\nFound in Measurement\nConcept name: Systolic blood pressure\n\nMarital status: 40766231\n\nFound in Observation\nConcept name: Marital status [NHANES]\n\n\n\n\n\n\n\nData retrieval\nWe have identified the concepts that we are interested in. Now it is time to retrieve data from the OMOP database.\nBear in mind that we do not usually want to retrieve all the columns related to a concept. You should check the columns of the condition_occurrence, measurement and observation tables to identify the columns that are relevant to our analysis.\nFor example, let’s say that we want to obtain the numerical value of the systolic blood pressure. We can check again the columns available in the measurement table:\n\nhelper$columns(\"measurement\")\n\n$`opal-demo`\n$`opal-demo`$measurement\n [1] \"measurement_id\"                \"person_id\"                    \n [3] \"measurement_concept_id\"        \"measurement_date\"             \n [5] \"measurement_datetime\"          \"measurement_time\"             \n [7] \"measurement_type_concept_id\"   \"operator_concept_id\"          \n [9] \"value_as_number\"               \"value_as_concept_id\"          \n[11] \"unit_concept_id\"               \"range_low\"                    \n[13] \"range_high\"                    \"provider_id\"                  \n[15] \"visit_occurrence_id\"           \"visit_detail_id\"              \n[17] \"measurement_source_value\"      \"measurement_source_concept_id\"\n[19] \"unit_source_value\"             \"value_source_value\"           \n\n\nWe can see that the measurement table contains the value_as_number column, which contains the numerical value of the measurement.\nThis means that we want to:\n\nFrom the measurement table,\nget the systolic blood pressure (whose concept ID is 3004249),\ntaking only the value_as_number column\n\nWe can retrieve this data using the auto method of the helper interface object. This method automates the process of retrieving the data from the database and storing it in the mimiciv table:\n\nhelper$auto(\n    table = \"measurement\",\n    concepts = 3004249,\n    columns = \"value_as_number\"\n)\n\nThe data should have been stored in the mimiciv table. dsOMOP automatically translantes the concept IDs to their designated textual names for readability. This means that the column name will be the concept name, followed by the column name of the table (systolic_blood_pressure.value_as_number). We can check the current state of the mimiciv table in the server side at any time using the ds.summary function:\n\nds.summary(\"mimiciv\")\n\n$`opal-demo`\n$`opal-demo`$class\n[1] \"data.frame\"\n\n$`opal-demo`$`number of rows`\n[1] 100\n\n$`opal-demo`$`number of columns`\n[1] 6\n\n$`opal-demo`$`variables held`\n[1] \"person_id\"                              \n[2] \"gender_concept_id\"                      \n[3] \"year_of_birth\"                          \n[4] \"race_concept_id\"                        \n[5] \"ethnicity_concept_id\"                   \n[6] \"systolic_blood_pressure.value_as_number\"\n\n\nAs we can see, the mimiciv table now contains the systolic_blood_pressure.value_as_number column, which contains the numerical value of the systolic blood pressure. Let’s check a summary of this data:\n\nds.summary(\"mimiciv$systolic_blood_pressure.value_as_number\")\n\n$`opal-demo`\n$`opal-demo`$class\n[1] \"numeric\"\n\n$`opal-demo`$length\n[1] 100\n\n$`opal-demo`$`quantiles & mean`\n      5%      10%      25%      50%      75%      90%      95%     Mean \n 85.8500  91.7000 102.2500 113.0000 125.7500 143.2000 146.1500 114.7931 \n\n\nLet’s now use the renameVars from the dsHelper package, which we have seen before, to rename the variable to sbp for convenience:\n\ndh.renameVars(\n    df = \"mimiciv\", \n  current_names = c(\"systolic_blood_pressure.value_as_number\"),\n  new_names = c(\"sbp\"))\n\nLet’s check whether the changes have been applied by listing the columns of the mimiciv table:\n\nds.colnames(\"mimiciv\")\n\n$`opal-demo`\n[1] \"person_id\"            \"gender_concept_id\"    \"year_of_birth\"       \n[4] \"race_concept_id\"      \"ethnicity_concept_id\" \"sbp\"                 \n\n\nFrom this point, the data we have incorporated into the mimiciv table is ready to be used in our analysis as any other dataframe in DataSHIELD. To illustrate this, let’s perform a ds.histogram to visualize the distribution of the systolic blood pressure:\n\nds.histogram(\"mimiciv$sbp\")\n\n\n\n\n\n\n\n\n$breaks\n [1]  72.99226  81.48139  89.97053  98.45967 106.94880 115.43794 123.92707\n [8] 132.41621 140.90535 149.39448 157.88362\n\n$counts\n [1]  0  0  5  8 15  9  7  3  6  0\n\n$density\n [1] 0.00000000 0.00000000 0.01015497 0.01624795 0.03046490 0.01827894\n [7] 0.01421695 0.00609298 0.01218596 0.00000000\n\n$mids\n [1]  77.23683  85.72596  94.21510 102.70423 111.19337 119.68251 128.17164\n [8] 136.66078 145.14991 153.63905\n\n$xname\n[1] \"xvect\"\n\n$equidist\n[1] TRUE\n\nattr(,\"class\")\n[1] \"histogram\"\n\n\nLet’s now retrieve the data for the concept Marital status [NHANES]. Let’s start by checking the columns available in the observation table:\n\nhelper$columns(\"observation\")\n\n$`opal-demo`\n$`opal-demo`$observation\n [1] \"observation_id\"                \"person_id\"                    \n [3] \"observation_concept_id\"        \"observation_date\"             \n [5] \"observation_datetime\"          \"observation_type_concept_id\"  \n [7] \"value_as_number\"               \"value_as_string\"              \n [9] \"value_as_concept_id\"           \"qualifier_concept_id\"         \n[11] \"unit_concept_id\"               \"provider_id\"                  \n[13] \"visit_occurrence_id\"           \"visit_detail_id\"              \n[15] \"observation_source_value\"      \"observation_source_concept_id\"\n[17] \"unit_source_value\"             \"qualifier_source_value\"       \n\n\nIn this case, the observation table contains the value_as_concept_id column, which contains the concept ID of the observation value (which will be translated to the textual concept name by dsOMOP).\nLet’s use the auto method to retrieve it:\n\nFrom the observation table,\nget the marital status (whose concept ID is 40766231),\ntaking only the value_as_concept_id column\n\n\nhelper$auto(\n    table = \"observation\",\n    concepts = 40766231,\n    columns = \"value_as_concept_id\"\n)\n\nWe should now have the marital_status_nhanes.value_as_concept_id column in the mimiciv table. Let’s check the current state of the mimiciv table in the server side at any time using the ds.summary function:\n\nds.summary(\"mimiciv\")\n\n$`opal-demo`\n$`opal-demo`$class\n[1] \"data.frame\"\n\n$`opal-demo`$`number of rows`\n[1] 100\n\n$`opal-demo`$`number of columns`\n[1] 7\n\n$`opal-demo`$`variables held`\n[1] \"person_id\"                                \n[2] \"gender_concept_id\"                        \n[3] \"year_of_birth\"                            \n[4] \"race_concept_id\"                          \n[5] \"ethnicity_concept_id\"                     \n[6] \"sbp\"                                      \n[7] \"marital_status_nhanes.value_as_concept_id\"\n\n\nThe mimiciv table now contains the marital_status_nhanes.value_as_concept_id column. Let’s see a summary of this data:\n\nds.summary(\"mimiciv$marital_status_nhanes.value_as_concept_id\")\n\n$`opal-demo`\n$`opal-demo`$class\n[1] \"factor\"\n\n$`opal-demo`$length\n[1] 100\n\n$`opal-demo`$categories\n[1] \"divorced\"      \"married\"       \"never_married\" \"widowed\"      \n\n$`opal-demo`$`count of 'divorced'`\n[1] 10\n\n$`opal-demo`$`count of 'married'`\n[1] 36\n\n$`opal-demo`$`count of 'never_married'`\n[1] 30\n\n$`opal-demo`$`count of 'widowed'`\n[1] 12\n\n\nAs we can observe, the marital_status_nhanes.value_as_concept_id column contains the following categories:\n\ndivorced\nmarried\nnever married\nwidowed\n\nThose were originally numerical concept IDs in the database, but dsOMOP automatically translated them to their textual names.\n\n\nSubsetting data\nAnother fundamental operation in the dataset construction process that may be required for specific research contexts is subsetting. It is used to filter tables based on specific criteria, such as gender, age, conditions, measurements, observations or other characteristics. This operation can be used to determine a specific cohort of individuals, since all the data that is going to be retrieved from the database from that point will be related to the remaining individuals in the person table.\nLet’s see with a simple example how we can filter, using the subset operation, a dataset to only include women patients. But first, where do we find the gender data?\n\n\n\n\n\n\nClick to see the solution\n\n\n\n\n\nThe gender data is part of the person table under the gender_concept_id column, which was automatically retrieved when we created the helper interface object. This means that it is already available in the mimiciv table under mimiciv$gender_concept_id.\n\n\n\nLet’s first check that this variable is indeed available in the mimiciv table:\n\nds.colnames(\"mimiciv\")\n\n$`opal-demo`\n[1] \"person_id\"                                \n[2] \"gender_concept_id\"                        \n[3] \"year_of_birth\"                            \n[4] \"race_concept_id\"                          \n[5] \"ethnicity_concept_id\"                     \n[6] \"sbp\"                                      \n[7] \"marital_status_nhanes.value_as_concept_id\"\n\n\nLet’s also check a summary of this variable:\n\nds.summary(\"mimiciv$gender_concept_id\")\n\n$`opal-demo`\n$`opal-demo`$class\n[1] \"factor\"\n\n$`opal-demo`$length\n[1] 100\n\n$`opal-demo`$categories\n[1] \"female\" \"male\"  \n\n$`opal-demo`$`count of 'female'`\n[1] 43\n\n$`opal-demo`$`count of 'male'`\n[1] 57\n\n\nAs we can observe, the gender_concept_id column contains the following categories:\n\nfemale\nmale\n\nThose were also numerical concept IDs in the database that were matched to their corresponding concept names by dsOMOP.\nLet’s start by renaming the gender_concept_id column to gender for convenience:\n\ndh.renameVars(\n    df = \"mimiciv\", \n  current_names = c(\"gender_concept_id\"),\n  new_names = c(\"gender\"))\n\nFrom this point on, all the data is already in the DataSHIELD environment, so we will use DataSHIELD’s standard methods to perform the filtering.\nIn DataSHIELD, we first need to create a filter object in the server side that contains the value we want to filter by. Let’s create a gender_filter object that contains the value \"female\":\n\nds.make(newobj = \"gender_filter\", toAssign = \"c('female')\")\n\n$is.object.created\n[1] \"A data object &lt;gender_filter&gt; has been created in all specified data sources\"\n\n$validity.check\n[1] \"&lt;gender_filter&gt; appears valid in all sources\"\n\n\nNow we can use the ds.dataFrameSubset function to filter the mimiciv table to only include female patients by passing the gender_filter object as a parameter with the Boolean.operator parameter set to \"==\":\n\nds.dataFrameSubset(\n  df.name = \"mimiciv\",\n  V1.name = \"mimiciv$gender\",\n  V2.name = \"gender_filter\",\n  Boolean.operator = \"==\",\n  newobj = \"mimiciv\",\n  datasources = conns,\n  notify.of.progress = FALSE\n)\n\n$is.object.created\n[1] \"A data object &lt;mimiciv&gt; has been created in all specified data sources\"\n\n$validity.check\n[1] \"&lt;mimiciv&gt; appears valid in all sources\"\n\n\nThis will override the mimiciv table in the server side, which will now be the same table but only containing the female patients. Let’s check if this is the case:\n\nds.summary(\"mimiciv$gender\")\n\n$`opal-demo`\n$`opal-demo`$class\n[1] \"factor\"\n\n$`opal-demo`$length\n[1] 43\n\n$`opal-demo`$categories\n[1] \"female\" \"male\"  \n\n$`opal-demo`$`count of 'female'`\n[1] 43\n\n$`opal-demo`$`count of 'male'`\n[1] 0\n\n\nAs we can see, the mimiciv table contains only female patients now. If we were to retrieve any other data from the database with the auto method, it would only be related to the female patients from this point on.\n\n\nMore advanced operations\nLet’s now perform a more advanced operation. We want to study the relationship between chronic obstructive pulmonary disease (COPD) and two key biomarkers: tobacco use and asthma, so we will perform a generalized linear model (GLM) to estimate the odds ratio (OR) of COPD for each biomarker.\nWe start by creating a new helper interface object where we will retrieve the specified data. Since we are not going to use the helper object and the mimiciv table from the previous section anymore, we will create new objects with the same name:\n\nhelper &lt;- ds.omop.helper(\n    connections = conns,\n    resource = \"omop_demo.mimiciv\", \n    symbol = \"mimiciv\"\n)\n\nAs we can see, the mimiciv table now only contains the initial person table again:\n\nds.summary(\"mimiciv\")\n\n$`opal-demo`\n$`opal-demo`$class\n[1] \"data.frame\"\n\n$`opal-demo`$`number of rows`\n[1] 100\n\n$`opal-demo`$`number of columns`\n[1] 5\n\n$`opal-demo`$`variables held`\n[1] \"person_id\"            \"gender_concept_id\"    \"year_of_birth\"       \n[4] \"race_concept_id\"      \"ethnicity_concept_id\"\n\n\nAnd we have restored all the patients that were in the mimiciv table from the previous section, not just the female patients:\n\nds.summary(\"mimiciv$gender_concept_id\")\n\n$`opal-demo`\n$`opal-demo`$class\n[1] \"factor\"\n\n$`opal-demo`$length\n[1] 100\n\n$`opal-demo`$categories\n[1] \"female\" \"male\"  \n\n$`opal-demo`$`count of 'female'`\n[1] 43\n\n$`opal-demo`$`count of 'male'`\n[1] 57\n\n\nWe can now use the concept catalogs that we retrieved earlier to identify the concept IDs for COPD, tobacco use and asthma:\n\ncondition_list\n\n$`opal-demo`\n    concept_id                                                 concept_name\n1        27674                                          Nausea and vomiting\n2        29735                                         Candidiasis of mouth\n3        31317                                                    Dysphagia\n4        73553                                                  Arthropathy\n5        75576                                     Irritable bowel syndrome\n6        75860                                                 Constipation\n7        77670                                                   Chest pain\n8        78232                                          Shoulder joint pain\n9        79864                                           Hematuria syndrome\n10       80180                                               Osteoarthritis\n11       80502                                                 Osteoporosis\n12       80951                               Candidiasis of urogenital site\n13       81611                                Diverticular disease of colon\n14       81902                             Urinary tract infectious disease\n15      132736                                                   Bacteremia\n16      132797                                                       Sepsis\n17      134736                                                     Backache\n18      134765                                                     Cachexia\n19      138384                                      Acquired hypothyroidism\n20      140673                                               Hypothyroidism\n21      192357                                              Paralytic ileus\n22      192450                                           Retention of urine\n23      192671                                  Gastrointestinal hemorrhage\n24      192673                          Vascular insufficiency of intestine\n25      192680                                          Portal hypertension\n26      193688                           Clostridioides difficile infection\n27      193782                                      End-stage renal disease\n28      195306                                             Gastroduodenitis\n29      195562                                                  Hemorrhoids\n30      195581                                          Peritoneal adhesion\n31      196236                                                 Septic shock\n32      196463                                          Alcoholic cirrhosis\n33      196523                                                     Diarrhea\n34      197320                                          Acute kidney injury\n35      197444                        Vascular complication of medical care\n36      197494                                            Viral hepatitis C\n37      197672                                         Urinary incontinence\n38      197925                                Hemorrhage of rectum and anus\n39      197950                              Cellulitis and abscess of trunk\n40      198571                                            Cardiogenic shock\n41      198678                                Intestinal infectious disease\n42      198964                                          Chronic hepatitis C\n43      199074                                           Acute pancreatitis\n44      200219                                               Abdominal pain\n45      200451                          Chronic passive congestion of liver\n46      200528                                                      Ascites\n47      200618                                          Postoperative shock\n48      201061                                         Diaphragmatic hernia\n49      201826                                     Type 2 diabetes mellitus\n50      254061                                             Pleural effusion\n51      255573                             Chronic obstructive lung disease\n52      255848                                                    Pneumonia\n53      259992                              Ventilator associated pneumonia\n54      261600                                        Acute pulmonary edema\n55      261880                                                  Atelectasis\n56      313217                                          Atrial fibrillation\n57      314054                                        Aortic valve disorder\n58      314665                                               Atrial flutter\n59      314666                                    Old myocardial infarction\n60      315078                                                 Palpitations\n61      315286                               Chronic ischemic heart disease\n62      315831                              Chronic pulmonary heart disease\n63      316135                                       Atrioventricular block\n64      316139                                                Heart failure\n65      317002                                           Low blood pressure\n66      317003                                          Compression of vein\n67      317009                                                       Asthma\n68      317576                                    Coronary arteriosclerosis\n69      318736                                                     Migraine\n70      318772                                      Disorder of pericardium\n71      318800                              Gastroesophageal reflux disease\n72      319041                                      Orthostatic hypotension\n73      319049                                    Acute respiratory failure\n74      319835                                     Congestive heart failure\n75      319843                                        Mitral valve disorder\n76      319844                                 Acute ischemic heart disease\n77      320128                                       Essential hypertension\n78      321052                                  Peripheral vascular disease\n79      321462                                         Cardiac complication\n80      321887                                           Disorder of artery\n81      372448                                        Loss of consciousness\n82      372887                                            Disorder of brain\n83      372892                                     Metabolic encephalopathy\n84      373764                                         Toxic encephalopathy\n85      373995                                                     Delirium\n86      375519                                           Alcohol withdrawal\n87      376690                                               Cerebral edema\n88      376713                                          Cerebral hemorrhage\n89      377091                                                      Seizure\n90      378253                                                     Headache\n91      380378                                                     Epilepsy\n92      432545                                 Bacterial infectious disease\n93      432585                                   Blood coagulation disorder\n94      432867                                               Hyperlipidemia\n95      432870                                    Thrombocytopenic disorder\n96      432875                             Anemia due to chronic blood loss\n97      432881                                                 Pancytopenia\n98      433163                                 Deficiency of macronutrients\n99      433736                                                      Obesity\n100     433753                                                Alcohol abuse\n101     433968                                                  Candidiasis\n102     434004                                                 Hypervolemia\n103     434056                      Late effects of cerebrovascular disease\n104     434547                           Complication of surgical procedure\n105     434610                                                 Hyperkalemia\n106     434814        Late effect of medical and surgical care complication\n107     434894                                 Acute posthemorrhagic anemia\n108     435243                                           Alcohol dependence\n109     435515                          Hypo-osmolality and or hyponatremia\n110     435517                                                     Acidosis\n111     435788                            Disorder of phosphorus metabolism\n112     435796                                                  Dehydration\n113     435829                             Rheumatic disease of heart valve\n114     436073                                           Psychotic disorder\n115     436096                                                 Chronic pain\n116     436222                                        Altered mental status\n117     436238 Elevated level of transaminase and lactic acid dehydrogenase\n118     436659                                       Iron deficiency anemia\n119     436676                                Posttraumatic stress disorder\n120     436962                                                     Insomnia\n121     437233                                             Multiple myeloma\n122     437247                                    Anemia of chronic disease\n123     437264                                  Tobacco dependence syndrome\n124     437312                                                     Bleeding\n125     437382                                                Urine finding\n126     437390                                                    Hypoxemia\n127     437474                                      Postoperative infection\n128     437579                           Paroxysmal ventricular tachycardia\n129     437663                                                        Fever\n130     437779                             Streptococcal infectious disease\n131     437827                                    Pure hypercholesterolemia\n132     437833                                                  Hypokalemia\n133     438064                       Bacterial infection due to Pseudomonas\n134     438398                                                 Leukocytosis\n135     438725                             Disorder of magnesium metabolism\n136     438730                                                    Alkalosis\n137     439005                              Chronic alcoholism in remission\n138     439408                                          Graft complications\n139     439696 Hypertensive heart and renal disease with (congestive) he...\n140     439777                                                       Anemia\n141     440320                            Infection due to Escherichia coli\n142     440383                                          Depressive disorder\n143     440424                                                      Aphasia\n144     440530                                      Oropharyngeal dysphagia\n145     440674                                                         Gout\n146     440940        Methicillin resistant Staphylococcus aureus infection\n147     441258                                 Anemia in neoplastic disease\n148     441536                             Mixed acid-base balance disorder\n149     441829                         Hyperosmolality and or hypernatremia\n150     442019                                    Complication of procedure\n151     442077                                             Anxiety disorder\n152     442588                             Obstructive sleep apnea syndrome\n153     443211        Benign prostatic hyperplasia with outflow obstruction\n154     443238                                      Diabetic - poor control\n155     443344                                          Barrett's esophagus\n156     443447                                       Iatrogenic hypotension\n157     443530                                                 Hematochezia\n158     443597                               Chronic kidney disease stage 3\n159     443612                               Chronic kidney disease stage 4\n160     443734                 Ketoacidosis due to type 2 diabetes mellitus\n161     444044                                       Acute tubular necrosis\n162     444070                                                  Tachycardia\n163     444100                                                Mood disorder\n164     444101                                   Hypertensive heart failure\n165     444406                              Acute subendocardial infarction\n166     764123   Atherosclerosis of coronary artery without angina pectoris\n167    4008576                       Diabetes mellitus without complication\n168    4052648                                                   Disability\n169    4064161                                           Cirrhosis of liver\n170    4064452                                     ECG: atrial fibrillation\n171    4065288                                          EKG: atrial flutter\n172    4079687                                         Tumor lysis syndrome\n173    4088998                                 AV sequential pacing pattern\n174    4089488                                        Atrial pacing pattern\n175    4092038                                   Ventricular pacing pattern\n176    4094822                            Foreign body in respiratory tract\n177    4101362                                      Finding of urine output\n178    4126119                                            Toxic nephropathy\n179    4138456                                       ECG: sinus bradycardia\n180    4140598                                       ECG: sinus tachycardia\n181    4141820                                        ECG: sinus arrhythmia\n182    4144111          Gastroesophageal reflux disease without esophagitis\n183    4145510                            EKG: supraventricular tachycardia\n184    4145513                                            ECG: sinus rhythm\n185    4150981                                              Drug resistance\n186    4154290                               Paroxysmal atrial fibrillation\n187    4175154                    Disorder of the peripheral nervous system\n188    4182210                                                     Dementia\n189    4187218                         Pneumonitis due to inhaled substance\n190    4188331                                      Chronic pulmonary edema\n191    4193704                Type 2 diabetes mellitus without complication\n192    4209423                                          Nicotine dependence\n193    4229440                             Chronic congestive heart failure\n194    4232495                                       Primary cardiomyopathy\n195    4233565 Severe protein-calorie malnutrition (Gomez: less than 60 ...\n196    4245975                                              Hepatic failure\n197    4256228                                          Respiratory failure\n198    4268911                                                Disorientated\n199    4270024         Acute non-ST segment elevation myocardial infarction\n200    4282096                             Major depression, single episode\n201    4286201                                     Schizoaffective disorder\n202    4295261                                         Postmenopausal state\n203    4311499              Primary malignant neoplasm of respiratory tract\n204    4322175                    Late effect of complications of procedure\n205    4332246                                                     Aneurysm\n206    4339214                             Secondary pulmonary hypertension\n207    4353709                               Intracerebral vascular finding\n208   36712779                   Chronic total occlusion of coronary artery\n209   36712821                                     Postprocedural infection\n210   36712982 Unstable angina co-occurrent and due to coronary arterios...\n211   37016114               Acute on chronic hypoxemic respiratory failure\n212   37016349                Hyperglycemia due to type 2 diabetes mellitus\n213   37017432               Polyneuropathy due to type 2 diabetes mellitus\n214   37116361                            Accidental wound during procedure\n215   37311319                                                  Hypovolemia\n216   37394658                                                Severe sepsis\n217   37395564                                Hypoxemic respiratory failure\n218   40321716                                   Secondary thrombocytopenia\n219   40479192                               Chronic systolic heart failure\n220   40479576                              Chronic diastolic heart failure\n221   40480602                      Acute on chronic systolic heart failure\n222   40481043                     Acute on chronic diastolic heart failure\n223   40481762         Hemiplegia as late effect of cerebrovascular disease\n224   40481919                                     Coronary atherosclerosis\n225   40482801                       Type II diabetes mellitus uncontrolled\n226   40487064                               Sepsis due to Escherichia coli\n227   42537730                                Coronary artery graft present\n228   42537748                                    Acquired absence of organ\n229   42873170                            Dependence on supplemental oxygen\n230   43022062              Cardiovascular system complication of procedure\n231   43530681                                      Drug abuse in remission\n232   43530690                   Foot ulcer due to type 2 diabetes mellitus\n233   43530742 Paralytic syndrome on one side of the body as late effect...\n234   43531578       Chronic kidney disease due to type 2 diabetes mellitus\n235   44782421              Acute deep venous thrombosis of upper extremity\n236   44782429                   Chronic kidney disease due to hypertension\n237   44784217                                           Cardiac arrhythmia\n238   44784439         Benign hypertensive renal disease with renal failure\n239   44784631                               Pain due to neoplastic disease\n240   45757363                 Hypoglycemia due to type 2 diabetes mellitus\n241   45766207       Non-rheumatic mitral valve stenosis with regurgitation\n242   45768812                             Anemia in chronic kidney disease\n243   45768910                                         Uncomplicated asthma\n244   46271022                                       Chronic kidney disease\n245   46271075                          Acute hypoxemic respiratory failure\n246   46273390                                     Dependence on respirator\n\n\n\nobservation_list\n\n$`opal-demo`\n   concept_id                                                 concept_name\n1      432789                            Opioid analgesic adverse reaction\n2      433942                 Accident while engaged in household activity\n3      435928                                         Abnormal weight loss\n4      436583                                                         Fall\n5      438046 Medical accident to patient during surgical and medical care\n6      439996                               Anticoagulant adverse reaction\n7      440279                                                     Accident\n8      440922                                          Diabetic on insulin\n9      440927                             High risk drug monitoring status\n10     441207                                     Adverse reaction to drug\n11     441749                              Fall on or from stairs or steps\n12    2617452                       Hospital observation service, per hour\n13    3001062                                      History of Past illness\n14    3007397                                              Ventilator type\n15    3012697                                       History of Tobacco use\n16    3024265                            Body temperature measurement site\n17    3034263                                     Pain severity - Reported\n18    3039006                                              Oral care given\n19    4005823                                                 Tobacco user\n20    4014023                                              Palliative care\n21    4019967                                 Dependence on renal dialysis\n22    4036936                                              Oxygen delivery\n23    4060705                           Body mass index 25-29 - overweight\n24    4060985                                Body mass index 30+ - obesity\n25    4119499                                        Not for resuscitation\n26    4127294                                         Resuscitation status\n27    4135421                               Body mass index 20-24 - normal\n28    4138763                                 Acceptable pain level status\n29    4139934                                                     Homeless\n30    4140830                                           Fall on same level\n31    4143274                           History of cerebrovascular disease\n32    4148407                                   FH: Cardiovascular disease\n33    4162219       Patient transfer to postoperative anesthesia care unit\n34    4167217                           Family history of clinical finding\n35    4179242                        History of malignant neoplasm of skin\n36    4180749                    History of malignant neoplasm of prostate\n37    4182335                     Family history of ischemic heart disease\n38    4192791                                  Pain management (specialty)\n39    4203722                                  Patient encounter procedure\n40    4214956                       History of clinical finding in subject\n41    4215685                                    Past history of procedure\n42    4233464                           Legal physical restraint performed\n43    4256640                         Body mass index 40+ - severely obese\n44    4265599                      Patient transfer to intensive care unit\n45    4276526                                             Cigarette smoker\n46    4279614                                                 Asphyxiation\n47    4296248                                             Cost containment\n48    4311079       Place of occurrence of accident or poisoning, hospital\n49    4314870                 Place of occurrence of accident or poisoning\n50    4323345                                              History of fall\n51    4324190                      History of malignant neoplasm of breast\n52    4337265                                                 Bowel sounds\n53   21492835                                           Respiratory effort\n54   36717001                             Long-term current use of aspirin\n55   37116693                                      Stroke volume variation\n56   40479553                                    Cardiac pacemaker in situ\n57   40757693                          Indicators of pain or possible pain\n58   40758030                                           Preferred language\n59   40766231                                      Marital status [NHANES]\n60   46235654                                            Primary insurance\n61   46272450                        Long-term current use of drug therapy\n62   46272451                             Long-term current use of insulin\n63   46272666                            Coordination of family conference\n64   46273928                                         Liaising with family\n65   46273937                       Long-term current use of anticoagulant\n66   46274064                       History of antineoplastic chemotherapy\n\n\n\nmeasurement_list\n\n$`opal-demo`\n    concept_id                                                 concept_name\n1            0                                          No matching concept\n2      1175625                                      Breath rate spontaneous\n3      3000067           Parathyrin.intact [Mass/volume] in Serum or Plasma\n4      3000068                                oxyCODONE [Presence] in Urine\n5      3000099            Nuclear Ab [Units/volume] in Serum by Immunoassay\n6      3000285                               Sodium [Moles/volume] in Blood\n7      3000330                      Specific gravity of Urine by Test strip\n8      3000348         Leukocyte esterase [Presence] in Urine by Test strip\n9      3000456           Dacrocytes [Presence] in Blood by Light microscopy\n10     3000461                          Pressure support setting Ventilator\n11     3000483                               Glucose [Mass/volume] in Blood\n12     3000593     Cobalamin (Vitamin B12) [Mass/volume] in Serum or Plasma\n13     3000764                          Benzodiazepines [Presence] in Urine\n14     3000941            Linezolid [Susceptibility] by Disk diffusion (KB)\n15     3000963                            Hemoglobin [Mass/volume] in Blood\n16     3001122                    Ferritin [Mass/volume] in Serum or Plasma\n17     3001308         Cholesterol in LDL [Moles/volume] in Serum or Plasma\n18     3001318            Cholesterol.total/Cholesterol in HDL [Percentile]\n19     3001494 Erythrocytes [#/volume] in Urine sediment by Microscopy h...\n20     3001582                     Protein/Creatinine [Mass Ratio] in Urine\n21     3001893                  Eosinophils/100 leukocytes in Pleural fluid\n22     3001950             Amikacin [Susceptibility] by Disk diffusion (KB)\n23     3002020                             Barbiturates [Presence] in Urine\n24     3002091         Choriogonadotropin [Moles/volume] in Serum or Plasma\n25     3002113  Variant lymphocytes [Presence] in Blood by Light microscopy\n26     3002179                       Metamyelocytes/100 leukocytes in Blood\n27     3002331                    Protein [Mass/volume] in Peritoneal fluid\n28     3002400                        Iron [Mass/volume] in Serum or Plasma\n29     3002827        Microalbumin/Creatinine [Mass Ratio] in 24 hour Urine\n30     3002850         Tetracycline [Susceptibility] by Disk diffusion (KB)\n31     3002888              Erythrocyte distribution width [Entitic volume]\n32     3003105           Gentamicin [Susceptibility] by Disk diffusion (KB)\n33     3003132            Barbiturates [Presence] in Serum, Plasma or Blood\n34     3003181                               Sodium [Moles/volume] in Urine\n35     3003282               Leukocytes [#/volume] in Blood by Manual count\n36     3003396                 Base excess in Arterial blood by calculation\n37     3003403                       Glucose [Mass/volume] in Pleural fluid\n38     3003434                       Protein [Mass/volume] in Pleural fluid\n39     3003709                  Acetaminophen [Presence] in Serum or Plasma\n40     3003785         Carcinoembryonic Ag [Mass/volume] in Serum or Plasma\n41     3003906            Oxacillin [Susceptibility] by Disk diffusion (KB)\n42     3004249                                      Systolic blood pressure\n43     3004295                         Urea nitrogen [Mass/volume] in Blood\n44     3004297                                      Temperature Inhaled gas\n45     3004327           Lymphocytes [#/volume] in Blood by Automated count\n46     3004354            ceFAZolin [Susceptibility] by Disk diffusion (KB)\n47     3004410                     Hemoglobin A1c/Hemoglobin.total in Blood\n48     3004501                     Glucose [Mass/volume] in Serum or Plasma\n49     3004588              Protein electrophoresis panel - Serum or Plasma\n50     3004698                                     QRS duration in lead III\n51     3004905        Lipase [Enzymatic activity/volume] in Serum or Plasma\n52     3004921                                  Ventilation mode Ventilator\n53     3005087     Macrophages/100 leukocytes in Body fluid by Manual count\n54     3005131 Glucose mean value [Mass/volume] in Blood Estimated from ...\n55     3005158          Clindamycin [Susceptibility] by Disk diffusion (KB)\n56     3005309                    Salicylates [Presence] in Serum or Plasma\n57     3005456                            Potassium [Moles/volume] in Blood\n58     3005481          Spherocytes [Presence] in Blood by Light microscopy\n59     3005555                              Left ventricular Cardiac output\n60     3005606                     Pulmonary artery Systolic blood pressure\n61     3005629                                     Inhaled oxygen flow rate\n62     3005686           Bite cells [Presence] in Blood by Light microscopy\n63     3005715                  Vancomycin [Mass/volume] in Serum or Plasma\n64     3005719                         IgG [Mass/volume] in Serum or Plasma\n65     3005854           Burr cells [Presence] in Blood by Light microscopy\n66     3005897                 Protein [Mass/volume] in Urine by Test strip\n67     3006122            Meropenem [Susceptibility] by Disk diffusion (KB)\n68     3006135   Nucleated erythrocytes [#/volume] in Blood by Manual count\n69     3006175       Mucus [Presence] in Urine sediment by Light microscopy\n70     3006490 Calcium oxalate crystals [Presence] in Urine sediment by ...\n71     3006923 Alanine aminotransferase [Enzymatic activity/volume] in S...\n72     3007070          Cholesterol in HDL [Mass/volume] in Serum or Plasma\n73     3007124   Reticulocytes/100 erythrocytes in Blood by Automated count\n74     3007164                         IgA [Mass/volume] in Serum or Plasma\n75     3007220 Creatine kinase [Enzymatic activity/volume] in Serum or P...\n76     3007350 Amorphous sediment [Presence] in Urine sediment by Light ...\n77     3007359          Bilirubin.indirect [Mass/volume] in Serum or Plasma\n78     3007469                               Breath rate setting Ventilator\n79     3007733                             Chloride [Moles/volume] in Urine\n80     3007794                                                 P-R Interval\n81     3007876                                          Appearance of Urine\n82     3007913         Alveolar-arterial oxygen Partial pressure difference\n83     3008223                                     Glasgow coma score motor\n84     3008251                          Bicarbonate [Moles/volume] in Urine\n85     3008295                                Osmolality of Serum or Plasma\n86     3008308         Erythromycin [Susceptibility] by Disk diffusion (KB)\n87     3008449                                 S wave amplitude in lead III\n88     3008504           Vancomycin [Susceptibility] by Disk diffusion (KB)\n89     3008598         Thyroxine (T4) free [Mass/volume] in Serum or Plasma\n90     3008691      Amylase [Enzymatic activity/volume] in Peritoneal fluid\n91     3008855          Leukocytes other/100 leukocytes in Peritoneal fluid\n92     3008939    Band form neutrophils [#/volume] in Blood by Manual count\n93     3009094                                    Glasgow coma score verbal\n94     3009201                Thyrotropin [Units/volume] in Serum or Plasma\n95     3009306         Alpha-1-Fetoprotein [Mass/volume] in Serum or Plasma\n96     3009314             Cefepime [Susceptibility] by Disk diffusion (KB)\n97     3009497                                              Type of GI tube\n98     3009542                        Hematocrit [Volume Fraction] of Blood\n99     3009613                  Erythrocytes [#/volume] in Peritoneal fluid\n100    3009682                    Cortisol [Mass/volume] in Serum or Plasma\n101    3009744                        MCHC [Mass/volume] by Automated count\n102    3010189 Epithelial cells [#/area] in Urine sediment by Microscopy...\n103    3010321                              Right eye Pupil diameter Manual\n104    3010340       Triiodothyronine (T3) [Mass/volume] in Serum or Plasma\n105    3010421                                                  pH of Blood\n106    3010834                Platelets [#/volume] in Blood by Manual count\n107    3011335                     Digoxin [Mass/volume] in Serum or Plasma\n108    3011368       Poikilocytosis [Presence] in Blood by Light microscopy\n109    3011397                 Hemoglobin [Presence] in Urine by Test strip\n110    3011483 Granular casts [#/area] in Urine sediment by Microscopy l...\n111    3011544                       Albumin [Mass/volume] in Pleural fluid\n112    3011589                                 T wave amplitude in lead III\n113    3011904                   Phosphate [Mass/volume] in Serum or Plasma\n114    3011965                         Urea nitrogen [Mass/volume] in Urine\n115    3011987        Polychromasia [Presence] in Blood by Light microscopy\n116    3012030                        MCH [Entitic mass] by Automated count\n117    3012095                  Magnesium [Moles/volume] in Serum or Plasma\n118    3012222 Trimethoprim+Sulfamethoxazole [Susceptibility] by Disk di...\n119    3012336                 Haptoglobin [Mass/volume] in Serum or Plasma\n120    3012410                              Tidal volume setting Ventilator\n121    3012501                          Base excess in Blood by calculation\n122    3012516                               Albumin [Mass/volume] in Urine\n123    3012888                                     Diastolic blood pressure\n124    3012986 Erythrocytes [#/volume] in Cerebral spinal fluid by Autom...\n125    3013290                   Carbon dioxide [Partial pressure] in Blood\n126    3013429             Basophils [#/volume] in Blood by Automated count\n127    3013466                           aPTT in Blood by Coagulation assay\n128    3013502                                   Oxygen saturation in Blood\n129    3013603        Prostate specific Ag [Mass/volume] in Serum or Plasma\n130    3013650           Neutrophils [#/volume] in Blood by Automated count\n131    3013678 Triglyceride [Mass/volume] in Serum or Plasma --12 hours ...\n132    3013682               Urea nitrogen [Mass/volume] in Serum or Plasma\n133    3013707          Erythrocyte sedimentation rate by Westergren method\n134    3013721 Aspartate aminotransferase [Enzymatic activity/volume] in...\n135    3013731 Hepatitis B virus surface Ab [Units/volume] in Serum or P...\n136    3014080                       Oxygen gas flow Oxygen delivery system\n137    3014576                   Chloride [Moles/volume] in Serum or Plasma\n138    3014886           Neutrophils [#/volume] in Urine by Automated count\n139    3015273                                         Consistency of Stool\n140    3015280                   Blasts [#/volume] in Blood by Manual count\n141    3015377                    Calcium [Moles/volume] in Serum or Plasma\n142    3015536                          ST amplitude.J point+80 ms Lead III\n143    3015862         levoFLOXacin [Susceptibility] by Disk diffusion (KB)\n144    3016038                            Potassium [Moles/volume] in Urine\n145    3016242 Piperacillin+Tazobactam [Susceptibility] by Disk diffusio...\n146    3016251              Hemoglobin.gastrointestinal [Presence] in Stool\n147    3016293                Bicarbonate [Moles/volume] in Serum or Plasma\n148    3016311  Creatine kinase.MB/Creatine kinase.total in Serum or Plasma\n149    3016335                               Glasgow coma score eye opening\n150    3016407 Fibrinogen [Mass/volume] in Platelet poor plasma by Coagu...\n151    3016502                          Oxygen saturation in Arterial blood\n152    3016557 Hepatitis B virus core Ab [Units/volume] in Serum by Immu...\n153    3016573 Ampicillin+Sulbactam [Susceptibility] by Disk diffusion (KB)\n154    3016723                  Creatinine [Mass/volume] in Serum or Plasma\n155    3016750                                 Collection duration of Urine\n156    3016771       Amylase [Enzymatic activity/volume] in Serum or Plasma\n157    3016879                                  Cocaine [Presence] in Urine\n158    3016991              Thyroxine (T4) [Mass/volume] in Serum or Plasma\n159    3017143                     Hepatitis C virus Ab [Presence] in Serum\n160    3017181                           Myelocytes/100 leukocytes in Blood\n161    3017188                    Pulmonary artery Diastolic blood pressure\n162    3017250                            Creatinine [Mass/volume] in Urine\n163    3017400                            Magnesium [Moles/volume] in Urine\n164    3017594                     Tidal volume.spontaneous --on ventilator\n165    3017595           Ampicillin [Susceptibility] by Disk diffusion (KB)\n166    3018053                                  S wave duration in lead III\n167    3018405                     Lactate [Moles/volume] in Arterial blood\n168    3018465                      Oxygen saturation in Mixed venous blood\n169    3018572                             Chloride [Moles/volume] in Blood\n170    3018672                                             pH of Body fluid\n171    3018760 Blood smear finding [Identifier] in Blood by Light micros...\n172    3018834            Bilirubin.total [Presence] in Urine by Test strip\n173    3018954      Choriogonadotropin (pregnancy test) [Presence] in Urine\n174    3019298               Eosinophils/100 leukocytes in Peritoneal fluid\n175    3019351                           QRS terminal amplitude in lead III\n176    3019416         Acanthocytes [Presence] in Blood by Light microscopy\n177    3019473               Protein [Mass/volume] in Cerebral spinal fluid\n178    3019510 Hepatitis B virus surface Ag [Presence] in Serum or Plasm...\n179    3019550                     Sodium [Moles/volume] in Serum or Plasma\n180    3019634 Microscopic observation [Identifier] in Tissue by Wright ...\n181    3019761  Pappenheimer bodies [Presence] in Blood by Light microscopy\n182    3019800          Troponin T.cardiac [Mass/volume] in Serum or Plasma\n183    3019880         Schistocytes [Presence] in Blood by Light microscopy\n184    3019897    Erythrocyte distribution width [Ratio] by Automated count\n185    3019977                                         pH of Arterial blood\n186    3020149        25-hydroxyvitamin D3 [Mass/volume] in Serum or Plasma\n187    3020153        Ciprofloxacin [Susceptibility] by Disk diffusion (KB)\n188    3020416          Erythrocytes [#/volume] in Blood by Automated count\n189    3020460          C reactive protein [Mass/volume] in Serum or Plasma\n190    3020481                                           Respiration rhythm\n191    3020630                     Protein [Mass/volume] in Serum or Plasma\n192    3020716                                 Inhaled oxygen concentration\n193    3020891                                             Body temperature\n194    3021044       Iron binding capacity [Mass/volume] in Serum or Plasma\n195    3021119                      Calcium.ionized [Moles/volume] in Blood\n196    3021200 Thyroglobulin Ab [Units/volume] in Serum by Radioimmunoas...\n197    3021303          Hypochromia [Presence] in Blood by Light microscopy\n198    3021453                     Eosinophils/100 leukocytes in Body fluid\n199    3021502           Macrocytes [Presence] in Blood by Light microscopy\n200    3021595                      Phenytoin [Presence] in Serum or Plasma\n201    3021601                    Nitrite [Presence] in Urine by Test strip\n202    3021886                              Globulin [Mass/volume] in Serum\n203    3022022                                                 QRS duration\n204    3022094           Tobramycin [Susceptibility] by Disk diffusion (KB)\n205    3022217             INR in Platelet poor plasma by Coagulation assay\n206    3022318                                            Heart rate rhythm\n207    3022509 Hyaline casts [#/area] in Urine sediment by Microscopy lo...\n208    3022548               Glucose [Mass/volume] in Cerebral spinal fluid\n209    3022621                                    pH of Urine by Test strip\n210    3022747          cefTRIAXone [Susceptibility] by Disk diffusion (KB)\n211    3022797                                 R wave amplitude in lead III\n212    3022875          Positive end expiratory pressure setting Ventilator\n213    3023103                  Potassium [Moles/volume] in Serum or Plasma\n214    3023307         Penicillin G [Susceptibility] by Disk diffusion (KB)\n215    3023314     Hematocrit [Volume Fraction] of Blood by Automated count\n216    3023520                            Reticulocytes [#/volume] in Blood\n217    3023539                 Ketones [Mass/volume] in Urine by Test strip\n218    3023547                Leukocytes other/100 leukocytes in Body fluid\n219    3023599                      MCV [Entitic volume] by Automated count\n220    3024128             Bilirubin.total [Mass/volume] in Serum or Plasma\n221    3024153            Promyelocytes [#/volume] in Blood by Manual count\n222    3024171                                             Respiratory rate\n223    3024561                     Albumin [Mass/volume] in Serum or Plasma\n224    3024629                 Glucose [Mass/volume] in Urine by Test strip\n225    3024882        Oxygen/Total gas setting [Volume Fraction] Ventilator\n226    3024929             Platelets [#/volume] in Blood by Automated count\n227    3025019                           Gas flow Respiratory system airway\n228    3025255 Bacteria [#/area] in Urine sediment by Microscopy high po...\n229    3025315                                                  Body weight\n230    3025439 Airway pressure Ventilator --at peak inspiratory flow max...\n231    3025478      Tricyclic antidepressants [Presence] in Serum or Plasma\n232    3025616         Target cells [Presence] in Blood by Light microscopy\n233    3025809                                                 Q-T interval\n234    3026256                            QRS initial amplitude in lead III\n235    3026258                                       Q-T interval corrected\n236    3026314         Anisocytosis [Presence] in Blood by Light microscopy\n237    3026400                        Ethanol [Presence] in Serum or Plasma\n238    3026611                               Left eye Pupil diameter Manual\n239    3026692                    Albumin [Mass/volume] in Peritoneal fluid\n240    3026729                             Phosphate [Mass/volume] in Urine\n241    3026782                                          Osmolality of Urine\n242    3026904 Basophilic stippling [Presence] in Blood by Light microscopy\n243    3026910 Gamma glutamyl transferase [Enzymatic activity/volume] in...\n244    3027008                                  Opiates [Presence] in Urine\n245    3027018                                                   Heart rate\n246    3027114                 Cholesterol [Mass/volume] in Serum or Plasma\n247    3027162                                               Color of Urine\n248    3027315                           Oxygen [Partial pressure] in Blood\n249    3027597            Bilirubin.direct [Mass/volume] in Serum or Plasma\n250    3027598                                          Mean blood pressure\n251    3027801                  Oxygen [Partial pressure] in Arterial blood\n252    3027920           Ovalocytes [Presence] in Blood by Light microscopy\n253    3027944                             Amphetamines [Presence] in Urine\n254    3027946          Carbon dioxide [Partial pressure] in Arterial blood\n255    3028026                         IgM [Mass/volume] in Serum or Plasma\n256    3028074                         Pulmonary artery Mean blood pressure\n257    3028308                     Erythrocytes [#/volume] in Pleural fluid\n258    3028437          Cholesterol in LDL [Mass/volume] in Serum or Plasma\n259    3028468            Fragments [Presence] in Blood by Light microscopy\n260    3028561                                  R wave duration in lead III\n261    3028615           Eosinophils [#/volume] in Blood by Automated count\n262    3028662 Hepatitis A virus Ab [Units/volume] in Serum or Plasma by...\n263    3029187 Natriuretic peptide.B prohormone N-Terminal [Mass/volume]...\n264    3031147 Carbon dioxide, total [Moles/volume] in Blood by calculation\n265    3031951                          Benzodiazepines [Presence] in Blood\n266    3033364                   Cholesterol [Mass/volume] in Pleural fluid\n267    3033483                 Monocytes/100 leukocytes in Peritoneal fluid\n268    3033575             Monocytes [#/volume] in Blood by Automated count\n269    3034426                                        Prothrombin time (PT)\n270    3035206                               Physical mobility Braden scale\n271    3035359                          ST amplitude.J point+60 ms Lead III\n272    3035583 Leukocytes [#/area] in Urine sediment by Microscopy high ...\n273    3035816                        Nutrition intake pattern Braden scale\n274    3035851 Transitional cells [#/area] in Urine sediment by Microsco...\n275    3035995 Alkaline phosphatase [Enzymatic activity/volume] in Serum...\n276    3036098                              Sensory perception Braden scale\n277    3036180                                Methadone [Presence] in Urine\n278    3036277                                                  Body height\n279    3036354         Leukocytes other [#/volume] in Blood by Manual count\n280    3036518                               Left ventricular Stroke volume\n281    3036987                      Folate [Mass/volume] in Serum or Plasma\n282    3037022                               Moisture exposure Braden scale\n283    3037153             rifAMPin [Susceptibility] by Disk diffusion (KB)\n284    3037185                                  Protein [Presence] in Urine\n285    3037244 Yeast [#/area] in Urine sediment by Microscopy high power...\n286    3037274    HIV 1 Ab [Units/volume] in Serum or Plasma by Immunoassay\n287    3037278                               Anion gap 4 in Serum or Plasma\n288    3037318                               Physical activity Braden scale\n289    3037347                              Friction and shear Braden scale\n290    3037426               Urobilinogen [Presence] in Urine by Test strip\n291    3037490                                               Color of Stool\n292    3037556                       Urate [Mass/volume] in Serum or Plasma\n293    3037577            Monocytes/100 leukocytes in Cerebral spinal fluid\n294    3037663 Carbon dioxide, total [Moles/volume] in Arterial blood by...\n295    3037871 Macrophages/100 leukocytes in Cerebral spinal fluid by Ma...\n296    3037885           Microcytes [Presence] in Blood by Light microscopy\n297    3038047       Nitrofurantoin [Susceptibility] by Disk diffusion (KB)\n298    3038086          cefTAZidime [Susceptibility] by Disk diffusion (KB)\n299    3038104                       Monocytes/100 leukocytes in Body fluid\n300    3038288 Influenza virus B RNA [Presence] in Specimen by NAA with ...\n301    3039000                                           Anion gap in Blood\n302    3040168                    Immature granulocytes [#/volume] in Blood\n303    3041079 Nucleated cells [#/volume] in Pleural fluid by Automated ...\n304    3041372 Nucleated cells [#/volume] in Cerebral spinal fluid by Au...\n305    3041408 Nucleated cells [#/volume] in Peritoneal fluid by Automat...\n306    3041635 Macrophages/100 leukocytes in Peritoneal fluid by Manual ...\n307    3042347                                           Dressing for Wound\n308    3043387                    Monocytes/100 leukocytes in Pleural fluid\n309    3043728   WBC casts [Presence] in Urine sediment by Light microscopy\n310    3043970                                                Color of Skin\n311    3044938 Influenza virus A RNA [Presence] in Specimen by NAA with ...\n312    3046838                                                   Edema site\n313    3047181                              Lactate [Moles/volume] in Blood\n314    3051714     Fibrin D-dimer FEU [Mass/volume] in Platelet poor plasma\n315    4024509                                                Urine culture\n316    4024510                                Microbial culture, body fluid\n317    4035228                                Respiratory microbial culture\n318    4036044                                  Anaerobic microbial culture\n319    4107893                                                Blood culture\n320    4165398                                             Mycology culture\n321    4189544                                            Microbial culture\n322    4247906                                  Clostridium difficile assay\n323    4265595                                  Creatine kinase measurement\n324    4300293                                               Tissue culture\n325   21490516                        Inspiration [Time] Respiratory system\n326   21490580       Carbon dioxide production (VCO2) in Respiratory system\n327   21490650  Pressure max Respiratory system airway --during inspiration\n328   21490675                                Central venous pressure (CVP)\n329   21490712                               Left ventricular Cardiac index\n330   21490753                 Volume expired per minute Respiratory system\n331   21490854                      Tidal volume Ventilator --on ventilator\n332   21490880                         Left ventricular Stroke volume index\n333   21490888                               PCA lockout time Infusion pump\n334   21490963                               Right pupil Pupillary response\n335   21491186                                   Endotracheal tube Diameter\n336   21491763                                Left pupil Pupillary response\n337   21492239                       Systolic blood pressure by Noninvasive\n338   21492240                      Diastolic blood pressure by Noninvasive\n339   21492241                           Mean blood pressure by Noninvasive\n340   21492838                                               Skin integrity\n341   21494965                                               Passing flatus\n342   21494966                    Physical findings of Abdomen by Palpation\n343   36203862                                              Color of Sputum\n344   36303946   Pressure.plateau Respiratory system airway --on ventilator\n345   36684829                            Richmond Agitation-Sedation Scale\n346   40760766       Tidal volume.inspired maximum setting Ventilator alarm\n347   40762499        Oxygen saturation in Arterial blood by Pulse oximetry\n348   40762903                              Apnea interval Ventilator alarm\n349   40763080 Lactate dehydrogenase [Enzymatic activity/volume] in Peri...\n350   42527086                                         Mean airway pressure\n351   42527140                                Total PEEP Respiratory system\n352   43055270                                           Wound closure type\n353   46236952 Glomerular filtration rate/1.73 sq M.predicted [Volume Ra...\n\n\nCan you identify the concept IDs for COPD, tobacco use and asthma?\n\n\n\n\n\n\nClick to see the solution\n\n\n\n\n\n\nChronic obstructive pulmonary disease: 255573\n\nFound in Condition occurrence\nConcept name: Chronic obstructive lung disease\n\nTobacco use: 4005823\n\nFound in Observation\nConcept name: Tobacco user\n\nAsthma: 317009\n\nFound in Condition occurrence\nConcept name: Asthma\n\n\n\n\n\nLet’s now retrieve these variables from the database. In this case, our strategy will be to retrieve any form of data related to the variables we are studying. OMOP CDM tables are designed to only register the presence of a concept in a patient, so we will have to retrieve those and create auxiliar boolean variables that indicate the presence of the concept in the patient. This means that we can just retrieve the basic identifiers for each concept:\n\nFrom the condition_occurrence table,\nget COPD (whose concept ID is 255573) and asthma (whose concept ID is 317009),\ntaking only the condition_occurrence_id column\n\n\nhelper$auto(\n    table = \"condition_occurrence\",\n    concepts = c(255573, 317009),\n    columns = \"condition_occurrence_id\"\n)\n\n\nFrom the observation table,\nget tobacco use (whose concept ID is 4005823),\ntaking only the observation_id column\n\n\nhelper$auto(\n    table = \"observation\",\n    concepts = 4005823,\n    columns = \"observation_id\"\n)\n\nWe can now check the current state of the mimiciv table:\n\nds.summary(\"mimiciv\")\n\n$`opal-demo`\n$`opal-demo`$class\n[1] \"data.frame\"\n\n$`opal-demo`$`number of rows`\n[1] 100\n\n$`opal-demo`$`number of columns`\n[1] 8\n\n$`opal-demo`$`variables held`\n[1] \"person_id\"                                               \n[2] \"gender_concept_id\"                                       \n[3] \"year_of_birth\"                                           \n[4] \"race_concept_id\"                                         \n[5] \"ethnicity_concept_id\"                                    \n[6] \"chronic_obstructive_lung_disease.condition_occurrence_id\"\n[7] \"asthma.condition_occurrence_id\"                          \n[8] \"tobacco_user.observation_id\"                             \n\n\nAs we can see, the mimiciv table now contains:\n\nchronic_obstructive_lung_disease.condition_occurrence_id\ntobacco_user.observation_id\nasthma.condition_occurrence_id\n\nWe can now create boolean variables that indicate the presence of each concept in the patient. DataSHIELD will not transform an ID to a boolean if it is in a string format, so this process involves two steps:\n\nTransforming the ID to numeric\nTransforming the numeric ID to boolean\n\nLet’s start by transforming the COPD variable:\n\n# Convert COPD ID to numeric\nds.asNumeric(\n    x.name = \"mimiciv$chronic_obstructive_lung_disease.condition_occurrence_id\",\n    newobj = \"copd_numeric\",\n    datasources = conns\n)\n\n$is.object.created\n[1] \"A data object &lt;copd_numeric&gt; has been created in all specified data sources\"\n\n$validity.check\n[1] \"&lt;copd_numeric&gt; appears valid in all sources\"\n\n# Convert numeric COPD to boolean\nds.Boole(\n    V1 = \"copd_numeric\",\n    V2 = 0,\n    Boolean.operator = \"!=\",\n    numeric.output = TRUE,\n    na.assign = 0,\n    newobj = \"copd\",\n    datasources = conns\n)\n\n$is.object.created\n[1] \"A data object &lt;copd&gt; has been created in all specified data sources\"\n\n$validity.check\n[1] \"&lt;copd&gt; appears valid in all sources\"\n\n\nThis has created a copd object in the server that contains the boolean variables indicating the presence of COPD in the patient.\n\nds.table(\"copd\")\n\n\n Data in all studies were valid \n\nStudy 1 :  No errors reported from this study\n\n\n$output.list\n$output.list$TABLE_rvar.by.study_row.props\n    study\ncopd opal-demo\n  0          1\n  1          1\n  NA       NaN\n\n$output.list$TABLE_rvar.by.study_col.props\n    study\ncopd opal-demo\n  0       0.87\n  1       0.13\n  NA      0.00\n\n$output.list$TABLE_rvar.by.study_counts\n    study\ncopd opal-demo\n  0         87\n  1         13\n  NA         0\n\n$output.list$TABLES.COMBINED_all.sources_proportions\ncopd\n   0    1   NA \n0.87 0.13 0.00 \n\n$output.list$TABLES.COMBINED_all.sources_counts\ncopd\n 0  1 NA \n87 13  0 \n\n\n$validity.message\n[1] \"Data in all studies were valid\"\n\n\nLet’s now repeat the same process for the tobacco use variable:\n\n# Convert tobacco ID to numeric\nds.asNumeric(\n    x.name = \"mimiciv$tobacco_user.observation_id\",\n    newobj = \"tobacco_numeric\",\n    datasources = conns\n)\n\n$is.object.created\n[1] \"A data object &lt;tobacco_numeric&gt; has been created in all specified data sources\"\n\n$validity.check\n[1] \"&lt;tobacco_numeric&gt; appears valid in all sources\"\n\n# Convert numeric tobacco to boolean \nds.Boole(\n    V1 = \"tobacco_numeric\",\n    V2 = 0,\n    Boolean.operator = \"!=\",\n    numeric.output = TRUE,\n    na.assign = 0,\n    newobj = \"tobacco\",\n    datasources = conns\n)\n\n$is.object.created\n[1] \"A data object &lt;tobacco&gt; has been created in all specified data sources\"\n\n$validity.check\n[1] \"&lt;tobacco&gt; appears valid in all sources\"\n\n\nand for the asthma variable:\n\n# Convert asthma ID to numeric \nds.asNumeric(\n    x.name = \"mimiciv$asthma.condition_occurrence_id\",\n    newobj = \"asthma_numeric\", \n    datasources = conns\n)\n\n$is.object.created\n[1] \"A data object &lt;asthma_numeric&gt; has been created in all specified data sources\"\n\n$validity.check\n[1] \"&lt;asthma_numeric&gt; appears valid in all sources\"\n\n# Convert numeric asthma to boolean\nds.Boole(\n    V1 = \"asthma_numeric\",\n    V2 = 0,\n    Boolean.operator = \"!=\", \n    numeric.output = TRUE,\n    na.assign = 0,\n    newobj = \"asthma\",\n    datasources = conns\n)\n\n$is.object.created\n[1] \"A data object &lt;asthma&gt; has been created in all specified data sources\"\n\n$validity.check\n[1] \"&lt;asthma&gt; appears valid in all sources\"\n\n\nWe can now check the presence of the tobacco and asthma objects in the server side:\n\nds.table(\"tobacco\")\n\n\n Data in all studies were valid \n\nStudy 1 :  No errors reported from this study\n\n\n$output.list\n$output.list$TABLE_rvar.by.study_row.props\n       study\ntobacco opal-demo\n     0          1\n     1          1\n     NA       NaN\n\n$output.list$TABLE_rvar.by.study_col.props\n       study\ntobacco opal-demo\n     0       0.96\n     1       0.04\n     NA      0.00\n\n$output.list$TABLE_rvar.by.study_counts\n       study\ntobacco opal-demo\n     0         96\n     1          4\n     NA         0\n\n$output.list$TABLES.COMBINED_all.sources_proportions\ntobacco\n   0    1   NA \n0.96 0.04 0.00 \n\n$output.list$TABLES.COMBINED_all.sources_counts\ntobacco\n 0  1 NA \n96  4  0 \n\n\n$validity.message\n[1] \"Data in all studies were valid\"\n\n\n\nds.table(\"asthma\")\n\n\n Data in all studies were valid \n\nStudy 1 :  No errors reported from this study\n\n\n$output.list\n$output.list$TABLE_rvar.by.study_row.props\n      study\nasthma opal-demo\n    0          1\n    1          1\n    NA       NaN\n\n$output.list$TABLE_rvar.by.study_col.props\n      study\nasthma opal-demo\n    0       0.91\n    1       0.09\n    NA      0.00\n\n$output.list$TABLE_rvar.by.study_counts\n      study\nasthma opal-demo\n    0         91\n    1          9\n    NA         0\n\n$output.list$TABLES.COMBINED_all.sources_proportions\nasthma\n   0    1   NA \n0.91 0.09 0.00 \n\n$output.list$TABLES.COMBINED_all.sources_counts\nasthma\n 0  1 NA \n91  9  0 \n\n\n$validity.message\n[1] \"Data in all studies were valid\"\n\n\nWe can now perform the GLM analysis using the ds.glm function from DataSHIELD:\n\nds.glm(\n    formula = \"copd ~ tobacco + asthma\",\n    family = \"binomial\",\n    datasources = conns\n)\n\n$Nvalid\n[1] 100\n\n$Nmissing\n[1] 0\n\n$Ntotal\n[1] 100\n\n$disclosure.risk\n          RISK OF DISCLOSURE\nopal-demo                  0\n\n$errorMessage\n          ERROR MESSAGES\nopal-demo \"No errors\"   \n\n$nsubs\n[1] 100\n\n$iter\n[1] 18\n\n$family\n\nFamily: binomial \nLink function: logit \n\n\n$formula\n[1] \"copd ~ tobacco + asthma\"\n\n$coefficients\n              Estimate   Std. Error      z-value      p-value low0.95CI.LP\n(Intercept)  -1.845827    0.3106304 -5.942196444 2.812281e-09    -2.454651\ntobacco       1.152680    1.2635233  0.912274032 3.616245e-01    -1.323781\nasthma      -17.548914 2953.9650106 -0.005940799 9.952600e-01 -5807.213946\n            high0.95CI.LP         P_OR low0.95CI.P_OR high0.95CI.P_OR\n(Intercept)     -1.237002 1.363636e-01     0.07909909       0.2249582\ntobacco          3.629140 3.166667e+00     0.26612726      37.6803863\nasthma        5772.116119 2.391132e-08     0.00000000             Inf\n\n$dev\n[1] 73.92114\n\n$df\n[1] 97\n\n$output.information\n[1] \"SEE TOP OF OUTPUT FOR INFORMATION ON MISSING DATA AND ERROR MESSAGES\"\n\n\nNote: Our dataset is very small, so the GLM analysis is not very reliable. This is just an example of how to perform a GLM analysis in DataSHIELD with data imported from an OMOP database.\n\n\nLogout\nDo not forget to logout from the DataSHIELD server after finishing the exercise:\n\ndatashield.logout(conns)",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>dsOMOP Workshop</span>"
    ]
  }
]